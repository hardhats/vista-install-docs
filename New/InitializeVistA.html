<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>InitializeVistA</title>
  <link href="stylesheets/normalize.css" rel="stylesheet">
  <link href="stylesheets/main.css" rel="stylesheet">
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="vista-initialization">VistA Initialization</h1>
<p>Authors: Sam Habiel</p>
<p>License:</p>
<p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/80x15.png" alt="image" /></a></p>
<p>Attributions: Original instructions by Fil Beza and Nancy Anthracite; this set has been updated by Sam Habiel. Last updated in February 2018.</p>
<p>If you have reached this point, it means that you have finished <a href="./InstallCache.html">Install Cache</a>; or <a href="./InstallGTM.html">Install GT.M/YottaDB</a> and <a href="./InstallVistAOnGTM.html">Install VistA on GT.M/YottaDB</a>.</p>
<h2 id="gt.myottadb-note">GT.M/YottaDB Note</h2>
<p>YottaDB is a fork of GT.M. In VistA, everything that says GT.M will work equally well for YottaDB. When running <code>^ZTMGRSET</code> or <code>^DINIT</code>, choose GT.M on Unix for YottaDB.</p>
<h2 id="getting-into-the-direct-mode-aka-programmer-mode">Getting into the Direct Mode (AKA Programmer Mode)</h2>
<p>Before there were <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPLs</a>, Mumps always has had something called Direct Mode, also known as Programmer Mode, which is a simplified REPL. Normally, end users are not allowed to access Programmer Mode as it is essentially like running as root on a Unix System.</p>
<p>To connect to VISTA and start configuring it, you need a terminal emulator that emulates VT-100, VT-220, VT-320 or VT-52. By default, most terminal emulators do that already, but you cannot use the rxvt terminal emulator.</p>
<p>If you modified your $TERM, you need to make sure it's either <code>xterm</code> or <code>ansi</code>. Others generally will work, but I am sure of these two.</p>
<p>To get into Direct Mode using Cache, on Windows you need to right click on the Cache Cube and choose Terminal. If you have a licensed version of Cache, you can also use Telnet to connect to the Terminal. Please note that Windows Telnet does not emulate VT-200 series terminals properly, so you may have some issues with it. If you want to use Telnet, I recommend downloading PuTTY (<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/" class="uri">http://www.chiark.greenend.org.uk/~sgtatham/putty/</a>) or TeraTerm (<a href="https://ttssh2.osdn.jp/index.html.en" class="uri">https://ttssh2.osdn.jp/index.html.en</a>).</p>
<p>If you use PuTTY, change the function key bindings so that they behave like VT-100+. See here: <a href="https://the.earth.li/~sgtatham/putty/0.58/htmldoc/Chapter4.html#config-funkeys" class="uri">https://the.earth.li/~sgtatham/putty/0.58/htmldoc/Chapter4.html#config-funkeys</a>.</p>
<p>On a Mac, Terminal is a fully featured terminal emulator. You may wish to use System Preferences to configure the function keys to send Function commands, rather than dimming your screen or muting your volume. Otherwise, you have to use FN all the time to override the function keys (<a href="https://support.apple.com/en-us/HT204436" class="uri">https://support.apple.com/en-us/HT204436</a>).</p>
<p>On Linux, you can use any Terminal Emulator program with the exception of rxvt. You can actually even use PuTTY on Linux, but F1 may be bound to do help. You need to unmap that in the Terminal application (<a href="http://askubuntu.com/questions/37313/how-do-i-deactivate-f1-and-f10-keybindings-in-gnome-terminal" class="uri">http://askubuntu.com/questions/37313/how-do-i-deactivate-f1-and-f10-keybindings-in-gnome-terminal</a>).</p>
<p>If a VistA system was installed by you or somebody else in the &quot;Cloud&quot;, you will almost certainly need to use Secure Shell (SSH) to log in. If you use Telnet, there are some existential questions you have to ask yourself. SSH is a protocol written in the mid-90s to replace Telnet. It's the standard of connecting to other computers on the Cloud. Nobody can see the traffic inside of SSH, whereas Telnet is just plain text. The ssh client comes installed by default in all Unices; on Windows, you can use PuTTY or TeraTerm.</p>
<p>After you open your terminal emulator, do the following:</p>
<p>If your VistA is hosted on a remote server, connect to that first.</p>
<p>On Cache on Linux or Mac, you need to run <code>ccontrol list</code> to find your instance name, and then run <code>csession &lt;instance name&gt;</code>.</p>
<p>On GT.M/YottaDB, you need to source your environment file. If you followed this guide, it should be in /var/db/&lt;name&gt; as env.vista. To source, type <code>. /var/db/&lt;name&gt;/env.vista</code> (The dot is all by itself, followed by a space). Then type <code>mumps -dir</code> to go into direct mode.</p>
<p>You will see something like this:</p>
<div class="code"><code>GTM></code></div>
<p>or in Cache:</p>
<div class="code"><code>USER></code></div>
<p>If you are in Cache, you need to switch namespaces. (If you don't remember, type ? to see your choices.)</p>
<div class="code"><code>><strong>D ^%CD</strong>

NAMESPACE// <strong>VISTA</strong></code></div>
<h2 id="note-to-gt.myottadb-users">Note to GT.M/YottaDB Users</h2>
<p>Due to the fact that Cache does not enforce the M standard as strictly, many illegal instructions have been incorporated into VistA code. In addition, neither Cache nor GT.M/YottaDB is fully M95 standards compliant. As a result, ensuring that new code supports both systems is something of a game. For these reasons, the hardhats community maintains fixes for these routines and, when possible, sends the fixes back to the VA. In the future, the OSEHRA repositories will contain the fixes so that end users don't have to download the code and fix it themselves.</p>
<p>The WorldVistA distribution of VistA is GT.M/YottaDB compatible; you don't need any fixes for it, but the following provides a lot more functionality.</p>
<p>If you downloaded vxVistA or FOIA VistA, you need to copy the routines from this repository to your routines directory: <a href="https://github.com/shabiel/Kernel-GTM" class="uri">https://github.com/shabiel/Kernel-GTM</a>. Here's how to do it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1">$ <span class="fu">wget</span> https://github.com/shabiel/Kernel-GTM/releases/download/XU-8.0-10002/virgin_install.zip</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">$ <span class="fu">unzip</span> virgin_install.zip -d /path/to/database/r/</a></code></pre></div>
<h2 id="note-to-cache-users">Note to Cache Users</h2>
<p>The evaluation version of Cache won't let you run more than one foreground process and 20 background processes. You can certainly configure VistA, but don't try to run the RPC broker. A &quot;friend&quot; wasted a lot of my time because he had an evaluation version and couldn't start the RPC broker. You may also need to restart Cache repeatedly, as it sometimes &quot;forgets&quot; that you logged off.</p>
<h2 id="commands-and-what-they-mean-a-short-m-primer">Commands and what they mean (a short M primer)</h2>
<p>In the excerpts below, you will enter Mumps (M) commands into direct mode. Here are a few interesting ones:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode M"><code class="sourceCode matlab"><a class="sourceLine" id="cb2-1" data-line-number="1">S DUZ=<span class="fl">.5</span> ; S is a shortcut for SET, DUZ means user number; <span class="fl">.5</span> is a user that is always present on VistA systems.</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">D ^XUP ; D is a shortcut for DO, ^XUP is the name of the routine. ^XUP is the programmer mode menu runner.</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">; A semicolon, like in GAS assembly, is the comment character. M, like C, was written to replace assembly.</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">D Q^DI ; Do starting from Label Q in Routine DI. Q^DI is how to enter Fileman.</a></code></pre></div>
<h2 id="vista-text-mode-conventions">VistA Text Mode Conventions</h2>
<p>There are a few confusing conventions that outsiders don't understand right away. Here they are:</p>
<ul>
<li><code>//</code> means that the preceding text is the default. If you press enter, you will accept it.</li>
<li><code>Replace</code> means that the existing text is long and you can edit it. Typing <code>...</code> means that you will replace the entire thing;</li>
<li><code>END</code> appends to the end. You can also use <code>...</code> to signify a range between two elements in the existing text. You can also enter a unique segment of the text, press enter, and at the with prompt put in what you want to replace that bit of text with. If you don't type anything in, it deletes that part of the text.</li>
<li><code>@</code> deletes an item.</li>
<li><code>^</code> usually lets you quit what you are in the middle of.</li>
<li><code>^FIELD NAME</code> lets you jump to a field while editing other fields. You may be blocked, depending on what the programmer decided to allow.</li>
<li><code>?</code> Short Help. Typically it tells you that you need to type a number or text.</li>
<li><code>??</code> More Help. Should tell you what the field you are filling does. In the menu system, show all menus with what security keys they need.</li>
<li><code>???</code> In the menu system, display help for each immediate submenu.</li>
<li><code>????</code> In the menu system, display help for current menu.</li>
<li><code>&lt;enter&gt;</code> key is the main navigation key in VistA. Typing it after an entry enters that entry; typing when nothing is entered will move you forward or up, depending on the context.</li>
<li><code>Select &lt;item&gt;</code> Whenever you see select, you can select or add an item; after that, you can edit it.</li>
<li><code>Spacebar &lt;enter&gt;</code> Most of the time, VistA remembers the last entry you made for a particular field. To make the same entry again, do spacebar enter.</li>
</ul>
<h1 id="begin-to-set-up-the-vista-system">Begin to Set Up the VistA System</h1>
<h2 id="before-you-start">Before you Start</h2>
<p>You need to either invent or be given a few pieces of data:</p>
<ul>
<li>What are you going to call your Hospital or Clinic?</li>
<li>What's your station number? If you use VISTA or RPMS deployed by VA, IHS, or an external vendor; they will assign you your station number. Otherwise, pick a number from 130 to 199; or 971 to 999. These numbers are not used by the VA in VistA. In this guide, we will use 999.</li>
<li>What's your domain name? If you have a domain, use it; otherwise, invent one like <code>WWW.HABIEL.NAME</code>.</li>
<li>What's your parent domain? If you are not part of VA or IHS, you can use OSEHRA Forum: <code>FORUM.OSEHRA.ORG</code>.</li>
<li>Are you running on Cache vs GT.M/YottaDB; and what operating system you are running on? If you followed this guide from the very beginning, you would certainly know; but day to day users of VistA have no idea actually what it is running on.</li>
<li>What port number will you have VistA listen on for the RPC Broker? By convention, it's either 9000, 9200, or 9211.</li>
<li>What's the maximum number of processes that you will allow at once on a VistA system? Today (2016), commodity hardware (a good laptop, for example), can handle up to 200 concurrent processes. I usually set my test instances with a maximum of 30 processes, which is the number I use below.</li>
<li>What's your DNS Server? If you don't know, just use 8.8.8.8.</li>
</ul>
<p>Some of the configuration items below are taken from a system that may have had these entries previously created. If what you see on your screen doesn't exactly match what you see here, you can reply to Fileman with &quot;Y&quot; when adding a new entry; and skip past the fields that are indented by pressing <code>&lt;enter&gt;</code>. What matters in the end is that the final entry matches what is typed here.</p>
<h2 id="ztmgrset">ZTMGRSET</h2>
<p>The routine ZTMGRSET defines VistA global variables and saves system wide M routines that are M and OS specific. We need to kill ^%ZOSF to make sure we don't have old answers here; and sometimes having ^%ZOSF when you have just switched M implementations causes a catch 22 problem. The text scrape below is for GT.M/YottaDB; the one for Cache follows it.</p>
<div class="code"><code>><strong>K ^%ZOSF</strong>

><strong>D ^ZTMGRSET</strong>


ZTMGRSET Version 8.0 Patch level **34,36,69,94,121,127,136,191,275,355,446,584**
HELLO! I exist to assist you in correctly initializing the current account.
Which MUMPS system should I install?

1 = VAX DSM(V6), VAX DSM(V7)
2 = MSM-PC/PLUS, MSM for NT or UNIX
3 = Cache (VMS, NT, Linux), OpenM-NT
4 = 
5 = 
6 = 
7 = GT.M (VMS)
8 = GT.M (Unix)
System: <strong>8</strong>

I will now rename a group of routines specific to your operating system.
Routine:  ZOSVGUX Loaded, Saved as    %ZOSV

Routine:  ZIS4GTM Loaded, Saved as    %ZIS4
Routine:  ZISFGTM Loaded, Saved as    %ZISF
Routine:  ZISHGTM Loaded, Saved as    %ZISH
Routine:  XUCIGTM Loaded, Saved as    %XUCI
Routine: ZOSV2GTM Loaded, Saved as   %ZOSV2
Routine:  ZISTCPS Loaded, Saved as %ZISTCPS

NAME OF MANAGER'S UCI,VOLUME SET: VAH,ROU//
The value of PRODUCTION will be used in the GETENV api.
PRODUCTION (SIGN-ON) UCI,VOLUME SET: VAH,ROU//
The VOLUME name must match the one in PRODUCTION.
NAME OF VOLUME SET: ROU//
The temp directory for the system: '/tmp/'// <strong>&lt;enter&gt;</strong>
^%ZOSF setup


Now to load routines common to all systems.
Routine:   ZTLOAD Loaded, Saved as  %ZTLOAD
Routine:  ZTLOAD1 Loaded, Saved as %ZTLOAD1
Routine:  ZTLOAD2 Loaded, Saved as %ZTLOAD2
Routine:  ZTLOAD3 Loaded, Saved as %ZTLOAD3

...

Routine:   ZTRDEL Loaded, Saved as  %ZTRDEL
Routine:   ZTMOVE Loaded, Saved as  %ZTMOVE
Routine:    ZTBKC Loaded, Saved as   %ZTBKC
Want to rename the Fileman routines: No// <strong>Y</strong>
Routine:     DIDT Loaded, Saved as      %DT
Routine:    DIDTC Loaded, Saved as     %DTC
Routine:    DIRCR Loaded, Saved as     %RCR
Setting ^%ZIS('C')

Now, I will check your % globals...........

ALL DONE
></code></div>
<h3 id="on-caché">On Caché</h3>
<p>On Cache, you will see different prompts.</p>
<div class="code"><code>NAME OF MANAGER'S NAMESPACE: VISTA// <strong>&lt;enter&gt;</strong>

PRODUCTION (SIGN-ON) NAMESPACE: VISTA// <strong>&lt;enter&gt;</strong>

NAME OF THIS CONFIGURATION: VISTA// <strong>&lt;enter&gt;</strong></code></div>
<h2 id="fileman">Fileman</h2>
<p>Initialize Fileman to set your domain name and number and Operating System (GT.M/YottaDB shown below).</p>
<div class="code"><code>><strong>D ^DINIT</strong>

VA Fileman V.22.2

Initialize VA Fileman now?  NO// <strong>Y</strong>

    SITE NAME: PLA.ISC-WASH.DOMAIN.EXT// <strong>DEMO.OSEHRA.ORG</strong>

SITE NUMBER: 122000// <strong>999</strong>

Now loading MUMPS Operating System File

Do you want to change the MUMPS OPERATING SYSTEM File? NO//....

Now loading DIALOG and LANGUAGE Files.......................................

TYPE OF MUMPS SYSTEM YOU ARE USING: CACHE/OpenM// <strong>?</strong>
    Answer with MUMPS OPERATING SYSTEM NAME
   Choose from:
   CACHE/OpenM   
   DSM for OpenVMS   
   DTM-PC   
   GT.M(UNIX)   
   GT.M(VAX)   
   MSM   
   OTHER   

TYPE OF MUMPS SYSTEM YOU ARE USING: CACHE/OpenM// <strong>GT.M(UNIX)</strong>

Now loading other Fileman files--please
wait........................................................................

The following files have been installed:
   .11     INDEX
   .2      DESTINATION
   .31     KEY

   ...

  1.5219   SQLI_FOREIGN_KEY
  1.52191  SQLI_ERROR_TEXT
  1.52192  SQLI_ERROR_LOG


Re-indexing entries in the DIALOG file..........................

Compiling all forms ...

   DICATT                          (#.001)
   DIPTED                          (#.1001)
   DIKC EDIT                       (#.1101)

   ...

   SPNLP MS FM1                    (#45)
   SPNE ENTER/EDIT SYNONYM         (#46)
   LREPI                           (#47)

File #80 does not contain a field #3.
THE FORM "LREPI" COULD NOT BE COMPILED.

   ENPR MS                         (#48)
   ENPR ALL                        (#49)
   ENPR PRELIM                     (#50)

   ...

   PXRM TAXONOMY EDIT              (#125)
   PXRM TAXONOMY CHANGE LOG        (#126)
   PXRM DIALOG TAXONOMY EDIT       (#127)


INITIALIZATION COMPLETED IN 4 SECONDS.
></code></div>
<h2 id="zuset">ZUSET</h2>
<p>Also run D ^ZUSET to choose the correct version of ZU, the key login routine for the roll and scroll portions of VistA (GT.M/YottaDB shown).</p>
<div class="code"><code><strong>D ^ZUSET</strong>

This routine will rename the correct routine to ZU for you.

Rename ZUGTM to ZU, OK? No// <strong>Y</strong>
Routine ZUGTM was renamed to ZU</code></div>
<h2 id="device-configuration">Device Configuration</h2>
<p>Next is to set-up 4 devices: NULL, CONSOLE, VIRTUAL, and HFS (historically known as TELNET, due to usual access assignments). The NULL device corresponds to a place where we dump data we don't want; that's <code>/dev/null</code> on all Unices; <code>//./nul</code> on Windows. The NULL device is also known as the &quot;BIT BUCKET&quot;, for obvious reasons.</p>
<p>CONSOLE stands for the device the terminal presents itself as if directly connected to a computer. These days, no computer has real console devices. Linux still has an emulated console device: <code>/dev/tty</code>. Cache Terminal presents a console device called <code>|TRM|</code>.</p>
<p>VIRTUAL stands for all connections from Virtual Emulators. Unfortunately every different operating system provides a different console device:</p>
<ul>
<li>Linux: <code>/dev/pts</code> (Use with both Cache and GT.M/YottaDB)</li>
<li>macOS: <code>/dev/ttys</code> (ditto)</li>
<li>Cygwin: <code>/dev/cons</code> (GT.M [no YottaDB port for Cygwin exists])</li>
<li>Cache Telnet: <code>|TNT|</code> (Cache/Windows ONLY)</li>
</ul>
<p>The way set up devices is to edit the DEVICE file in Fileman, the Database Management System for VistA. Unlike most databases in the market, it provides a user interface as well, albeit a text-based one. To get into Fileman, you need to set your user (DUZ) to .5, and then go in.</p>
<h3 id="null-device">NULL Device</h3>
<p>There should only be one device named &quot;NULL&quot;. Unfortunately, there are three NULLs of various flavors in the FOIA; we need to make sure there is only one. The following procedure allows you to rename the nulls we don't want, and then delete a synonym.</p>
<div class="code"><code>><strong>S DUZ=.5</strong>
<strong>D Q^DI</strong>

VA Fileman 22.2

Select OPTION: <strong>1</strong>  ENTER OR EDIT FILE ENTRIES

Input to what File: <strong>DEVICE</strong>    (53 entries)
EDIT WHICH FIELD: ALL// <strong>&lt;enter&gt;</strong>

Select DEVICE NAME: <strong>NULL</strong>
     1   NULL      NT SYSTEM     NLA:
     2   NULL  GTM-UNIX-NULL    Bit Bucket (GT.M-Unix)     /dev/null     
     3   NULL-DSM      Bit Bucket     _NLA0:     
CHOOSE 1-3: <strong>1</strong>  NULL    NT SYSTEM     NLA:
NAME: NULL// <strong>NT-NULL</strong>
LOCATION OF TERMINAL: NT SYSTEM// <strong>^</strong>

Select DEVICE NAME: <strong>NULL</strong>
     1   NULL  GTM-UNIX-NULL    Bit Bucket (GT.M-Unix)     /dev/null     
     2   NULL-DSM      Bit Bucket     _NLA0:     
CHOOSE 1-2: 2  NULL-DSM    Bit Bucket     _NLA0:     
NAME: NULL-DSM// <strong>DSM-NULL</strong>
LOCATION OF TERMINAL: Bit Bucket// <strong>^</strong>

Select DEVICE NAME: <strong>NULL</strong>  GTM-UNIX-NULL    Bit Bucket (GT.M-Unix)    /dev/null 

NAME: GTM-UNIX-NULL// <strong>NULL</strong>
LOCATION OF TERMINAL: Bit Bucket (GT.M-Unix)  Replace <strong>&lt;enter&gt;</strong>
Select MNEMONIC: NULL// <strong>@</strong>
   SURE YOU WANT TO DELETE? <strong>Y</strong>  (Yes)
Select MNEMONIC: GTM-LINUX-NULL// <strong>@</strong>
   SURE YOU WANT TO DELETE? <strong>Y</strong>  (Yes)
Select MNEMONIC: <strong>&lt;enter&gt;</strong>
LOCAL SYNONYM: <strong>^</strong>

Select DEVICE NAME: <strong>&lt;enter&gt;</strong></code></div>
<p>At this point, we need to make sure that $I (short for $IO) for the device is correct for the system. All Unices have <code>/dev/null</code>; Windows is <code>//./nul</code>.</p>
<div class="code"><code>Select OPTION: <strong>EN</strong>TER OR EDIT FILE ENTRIES

Input to what File: DEVICE// <strong>&lt;enter&gt;</strong>             (54 entries)
EDIT WHICH FIELD: ALL// $I  

Select DEVICE NAME: <strong>NULL</strong>
$I: /dev/null// <strong>//./nul</strong> (or leave it alone as it is correct for Unix).

Select DEVICE NAME: <strong>&lt;enter&gt;</strong></code></div>
<h3 id="console-device">CONSOLE Device</h3>
<p>If you use Cache on Windows or Linux; or GT.M/YottaDB, you should be set <em>theoretically</em>. However, the FOIA set-up is incomplete or overspecified. I would prefer to select an entry and make sure it's properly specified:</p>
<p>You need to fill these fields <em>and no others</em>, as follows:</p>
<ul>
<li>NAME = CONSOLE</li>
<li>$I = /dev/tty on Linux; on Cache/Windows.</li>
<li>LOCATION OF TERMINAL = Physical Console</li>
<li>TYPE = VIRTUAL TERMINAL</li>
<li>SUBTYPE = C-VT220</li>
<li>SIGN-ON/SYSTEM DEVICE = YES</li>
</ul>
<p>Here's an example:</p>
<div class="code"><code>Select OPTION: <strong>EN</strong>TER OR EDIT FILE ENTRIES  



Input to what File: DEVICE//  <strong>&lt;enter&gt;</strong>            (54 entries)
EDIT WHICH FIELD: ALL// <strong>NAME</strong>  
THEN EDIT FIELD: <strong>$I</strong>
THEN EDIT FIELD: <strong>LOCATION OF TERMINAL  </strong>
THEN EDIT FIELD: <strong>TYPE</strong>
     1   TYPE  
     2   TYPE-AHEAD  
CHOOSE 1-2: 1  <strong>TYPE</strong>
THEN EDIT FIELD: <strong>SUBTYPE</strong>
THEN EDIT FIELD: <strong>SIGN-ON/SYSTEM DEVICE</strong>
THEN EDIT FIELD: <strong>&lt;enter&gt;</strong>
STORE THESE FIELDS IN TEMPLATE: <strong>&lt;enter&gt;</strong>


Select DEVICE NAME: <strong>CONSOLE</strong>
     1   CONSOLE      CONSOLE     OPA     
     2   CONSOLE  GTM-UNIX-CONSOLE    Console (GT.M)     /dev/tty     
     3   CONSOLE  CACHE-WINDOWS-CONSOLE    Console (Cache' on Windows)     |TRM|

CHOOSE 1-3: <strong>2</strong>  GTM-UNIX-CONSOLE    Console (GT.M)     /dev/tty     
NAME: GTM-UNIX-CONSOLE// <strong>&lt;enter&gt;</strong>
$I: /dev/tty// <strong>&lt;enter&gt;</strong>
LOCATION OF TERMINAL: Console (GT.M)// <strong>&lt;enter&gt;</strong>
TYPE: VIRTUAL TERMINAL// <strong>&lt;enter&gt;</strong>
SUBTYPE: C-VT100// <strong>C-VT220</strong>      Digital Equipment Corporation VT-220 terminal
SIGN-ON/SYSTEM DEVICE: <strong>Y</strong>  YES
</code></div>
<h3 id="virtual-device">VIRTUAL Device</h3>
<p>The FOIA only comes with Linux Virtual Terminal. As before, here's what you need to fill it out.</p>
<ul>
<li>NAME = VIRTUAL TERMINAL</li>
<li>$I = /dev/pts on Linux; /dev/ttys on macOS; /dev/pty0 on Cygwin; on Cache/Windows.</li>
<li>LOCATION OF TERMINAL = Virtual Terminal</li>
<li>TYPE = VIRTUAL TERMINAL</li>
<li>SUBTYPE = C-VT220</li>
<li>SIGN-ON/SYSTEM DEVICE = YES</li>
</ul>
<h3 id="hfs-device">HFS Device</h3>
<p>The HFS device is necessary because KIDS (the installation system used by VISTA) uses it to open files on the operating system. (Technically, it only uses the Open Parameters field.) The one that comes in FOIA looks like this:</p>
<pre class="sourceCode "><code>NAME: HFS                               $I: USER$:[TEMP]TMP.DAT
ASK DEVICE: YES                       ASK PARAMETERS: YES
LOCATION OF TERMINAL: Host File Server
ASK HOST FILE: YES                    ASK HFS I/O OPERATION: YES
OPEN COUNT: 870                       OPEN PARAMETERS: &quot;WNS&quot;
SUBTYPE: P-OTHER                      TYPE: HOST FILE SERVER</code></pre>
<p>You need to select it and change the settings as follows:</p>
<ul>
<li>NAME = HFS</li>
<li>$I = /tmp/hfs.dat or /dev/shm/hfs.dat or d:\hfs\, depending on your operating system (All Unices has /tmp/; only Linux has /dev/shm; last one is an example on Windows)</li>
<li>ASK DEVICE = YES</li>
<li>ASK PARAMETERS = @ (Delete it)</li>
<li>LOCATION OF TERMINAL = Host File Server</li>
<li>ASK HOST FILE = YES</li>
<li>ASK HFS I/O OPERATION = @ (Delete it)</li>
<li>OPEN PARAMETERS: &quot;WNS&quot; for Cache, (newversion) for GT.M/YottaDB (note quotes on Cache and their absence on GT.M/YottaDB)</li>
<li>SUBYTPE: P-HFS/80/99999</li>
<li>TYPE: HOST FILE SERVER</li>
</ul>
<h2 id="instance-domain-parent-domain-and-q-patch-domain">Instance Domain, Parent Domain, and Q-PATCH domain</h2>
<p>Next, a domain should be set up for the VistA instance. A domain name is typically used to uniquely identify an instance on a network. The parent domain is the domain responsible for routing your traffic to the outside world. The Q-PATCH domain is only necessary for developers wishing to use OSEHRA Forum. First we add the entry to the <code>DOMAIN</code> file through Fileman.</p>
<div class="code"><code>><strong>S DUZ=.5 D Q^DI</strong>

VA Fileman 22.0

Select OPTION: <strong>1</strong>  ENTER OR EDIT FILE ENTRIES

INPUT TO WHAT FILE: // <strong>DOMAIN</strong>
                                     (70 entries)
EDIT WHICH FIELD: ALL// <strong>ALL</strong>

Select DOMAIN NAME: <strong>DEMO.OSEHRA.ORG</strong>
  Are you adding 'DEMO.OSEHRA.ORG' as a new DOMAIN (the 71ST)? No// <strong>Y</strong>  (Yes)
FLAGS: <strong>^</strong>

Select DOMAIN NAME: <strong>Q-PATCH.OSEHRA.ORG</strong>
      Are you adding 'Q-PATCH.OSEHRA.ORG' as a new DOMAIN (the 96TH)? No// <strong>Y</strong>  (Yes)
NAME: Q-PATCH.OSEHRA.ORG// <strong>&lt;enter&gt;</strong>
FLAGS: <strong>Q</strong>
SECURITY KEY: <strong>&lt;enter&gt;</strong>
VALIDATION NUMBER: <strong>&lt;enter&gt;</strong>
NEW VALIDATION NUMBER: <strong>&lt;enter&gt;</strong>
DISABLE TURN COMMAND: <strong>&lt;enter&gt;</strong>
RELAY DOMAIN: <strong>&lt;enter&gt;</strong>
Select TRANSMISSION SCRIPT: <strong>MAIN</strong>
  Are you adding 'MAIN' as a new TRANSMISSION SCRIPT (the 1ST for this DOMAIN)?
 No// <strong>Y</strong>  (Yes)
  PRIORITY: <strong>1</strong>
  NUMBER OF ATTEMPTS: <strong>2</strong>
  TYPE: <strong>Simple</strong>  Simple Mail Transfer Protocol
  PHYSICAL LINK / DEVICE: <strong>NULL</strong> Stored internally as NULL
  NETWORK ADDRESS (MAILMAN HOST): <strong>FORUM.OSEHRA.ORG</strong>
  OUT OF SERVICE: <strong>&lt;enter&gt;</strong>
  TEXT:
  (on GT.M/YottaDB)
  1><strong>O H="FORUM.OSEHRA.ORG",P=TCP/GTM</strong>
  2><strong>C TCPCHAN-SOCKET25/GTM</strong>
  3><strong>&lt;enter&gt;</strong>
  (on Cache)
  1><strong>O H="FORUM.OSEHRA.ORG",P=TCP/IP-MAILMAN</strong>
  2><strong>C TCPCHAN-SOCKET25/CACHE/NT</strong>
  3><strong>&lt;enter&gt;</strong>
EDIT Option: <strong>^</strong>
  TRANSMISSION SCRIPT NOTES:
  1><strong>&lt;enter&gt;</strong>
Select TRANSMISSION SCRIPT: <strong>^</strong>

Select DOMAIN NAME: <strong>FORUM.OSEHRA.ORG</strong>
NAME: FORUM.OSEHRA.ORG// <strong>&lt;enter&gt;</strong>
      Are you adding 'FORUM.OSEHRA.ORG' as a new DOMAIN (the 97TH)? No// <strong>Y</strong>  (Yes)
FLAGS: <strong>Q</strong>
SECURITY KEY: <strong>&lt;enter&gt;</strong>
VALIDATION NUMBER: <strong>&lt;enter&gt;</strong>
NEW VALIDATION NUMBER: <strong>&lt;enter&gt;</strong>
DISABLE TURN COMMAND: <strong>&lt;enter&gt;</strong>
RELAY DOMAIN: <strong>&lt;enter&gt;</strong>
Select TRANSMISSION SCRIPT: <strong>MAIN</strong>
  Are you adding 'MAIN' as a new TRANSMISSION SCRIPT (the 1ST for this DOMAIN)?
 No// <strong>Y</strong>  (Yes)
  PRIORITY: <strong>1</strong>
  NUMBER OF ATTEMPTS: <strong>2</strong>
  TYPE: <strong>Simple</strong>  Simple Mail Transfer Protocol
  PHYSICAL LINK / DEVICE: <strong>NULL</strong> Stored internally as NULL
  NETWORK ADDRESS (MAILMAN HOST): <strong>FORUM.OSEHRA.ORG</strong>
  OUT OF SERVICE: <strong>&lt;enter&gt;</strong>
  TEXT:
  (on GT.M/YottaDB)
  1><strong>O H="FORUM.OSEHRA.ORG",P=TCP/GTM</strong>
  2><strong>C TCPCHAN-SOCKET25/GTM</strong>
  3><strong>&lt;enter&gt;</strong>
  (on Cache)
  1><strong>O H="FORUM.OSEHRA.ORG",P=TCP/IP-MAILMAN</strong>
  2><strong>C TCPCHAN-SOCKET25/CACHE/NT</strong>
  3><strong>&lt;enter&gt;</strong>

EDIT Option: ^
  TRANSMISSION SCRIPT NOTES:
  1><strong>&lt;enter&gt;</strong>
Select TRANSMISSION SCRIPT: ^

Select DOMAIN NAME: <strong>&lt;enter&gt;</strong>

Select OPTION: <strong>&lt;enter&gt;</strong>
></code></div>
<p>The next step is to find the IEN of the instance domain. This can be done by inquiring about the entry using Fileman and printing the Record Number:</p>
<div class="code"><code>><strong>S DUZ=.5 D Q^DI</strong>

VA Fileman 22.2

Select OPTION: <strong>5</strong>  INQUIRE TO FILE ENTRIES

OUTPUT FROM WHAT FILE: DOMAIN// <strong>DOMAIN</strong>   (71 entries)
Select DOMAIN NAME: <strong>DEMO.OSEHRA.ORG</strong>
ANOTHER ONE: <strong>&lt;enter&gt;</strong>
STANDARD CAPTIONED OUTPUT? Yes// <strong>Y</strong>  (Yes)
Include COMPUTED fields:  (N/Y/R/B): NO// <strong>Record Number (IEN)</strong>

NUMBER: 76                              NAME: DEMO.OSEHRA.ORG

Select DOMAIN NAME: <strong>&lt;enter&gt;</strong>

Select OPTION: <strong>&lt;enter&gt;</strong>
></code></div>
<p>Then we propagate that entry to the <code>Kernel System Parameters</code> and <code>RPC Broker Site Parameters</code> files. The value that is being set should be the same as the <code>NUMBER</code> value from the above result.</p>
<div class="code"><code>><strong>S $P(^XWB(8994.1,1,0),"^")=76</strong>
><strong>S $P(^XTV(8989.3,1,0),"^")=76</strong></code></div>
<p>Re-index the files after making this change.</p>
<div class="code"><code>><strong>F DIK="^XTV(8989.3,","^XWB(8994.1," S DA=1 D IXALL2^DIK,IXALL^DIK</strong></code></div>
<h2 id="christening">Christening</h2>
<p>System is christened using menu option XMCHIRS with FORUM.OSEHRA.ORG as the parent.</p>
<div class="code"><code>><strong>S DUZ=.5 D ^XUP</strong>

Setting up programmer environment
This is a TEST account.

Terminal Type set to: C-VT320

Select OPTION NAME: <strong>XMCHRIS</strong>       Christen a domain
Christen a domain

         * * * *  WARNING  * * * *

You are about to change the domain name of this facility
in the Mailman Site Parameters file.

Currently, this facility is named: FOIA.DOMAIN.EXT

You must be extremely sure before you proceed!

Are you sure you want to change the name of this facility? NO// <strong>YES</strong>
Select DOMAIN NAME: FOIA.DOMAIN.EXT// <strong>DEMO.OSEHRA.ORG</strong>

The domain name for this facility is now: DEMO.OSEHRA.ORG

PARENT: DOMAIN.EXT// <strong>FORUM.OSEHRA.ORG</strong>
TIME ZONE: EST// <strong>PST</strong>       PACIFIC STANDARD

FORUM.OSEHRA.ORG has been initialized as your 'parent' domain.
(Forum is usually the parent domain, unless this is a subordinate domain.)

You may edit the Mailman Site Parameter file to change your parent domain.

We will not initialize your transmission scripts.

Use the 'Subroutine editor' option under network management menu to add your
site passwords to the MINIENGINE script, and the 'Edit a script' option
to edit any domain scripts that you choose to.
></code></div>
<h2 id="set-up-taskman">Set-up Taskman</h2>
<p>Taskman is the VistA subsystem that is responsible for running processes in the background.</p>
<p>The first step is to find the box volume pair for the local machine.</p>
<div class="code"><code>><strong>D GETENV^%ZOSV W Y</strong></code></div>
<p>which will print out a message with four parts separated by <code>^</code> that could look something like (Cache):</p>
<div class="code"><code>VISTA^VISTA^palaven^VISTA:CACHE</code></div>
<p>or (GT.M/YottaDB)</p>
<div class="code"><code>VAH^ROU^Macintosh^ROU:Macintosh</code></div>
<p>The four pieces of the string are:</p>
<p><code>UCI^VOL^NODE^VOLUME:BOX</code></p>
<p>The fourth piece, the VOLUME:BOX pair, is referred to as the &quot;BOX VOLUME pair&quot;. The first component of the Box Volume pair is the Volume Set, which is used to define the location of routines for the VistA system. The second component, Box, references the system where the instance is found. In a Caché system, it would be the name of the Caché instance; while on GT.M/YottaDB, it should reference the hostname of the machine.</p>
<p>The Volume Set result needs to be altered in the <code>VOLUME SET</code> file, and we will reuse some setup by writing over the name of the first entry that is already in the VistA system. The first entry, the entry with an IEN of 1, can be selected by entering <code>`1</code>.</p>
<p>Then we rename the first Box-Volume pair in the <code>Taskman Site Parameters</code> file to match what was found above.</p>
<p>For this demonstration instance, the Volume Set will be <code>ROU</code>, as per the output above.</p>
<div class="code"><code>&gt;<strong>D Q^DI</strong>

VA Fileman 22.2

Select OPTION: 1  ENTER OR EDIT FILE ENTRIES

Input to what File: RPC BROKER SITE PARAMETERS// 14.5  VOLUME SET
                                          (1 entry)
EDIT WHICH FIELD: ALL// <strong>&lt;enter&gt;</strong>

Select VOLUME SET: <strong>`1</strong>
VOLUME SET: ROU// <strong>&lt;enter&gt;</strong>
TYPE: GENERAL PURPOSE VOLUME SET// <strong>&lt;enter&gt;</strong>
INHIBIT LOGONS?: NO// <strong>&lt;enter&gt;</strong>
LINK ACCESS?: NO// <strong>&lt;enter&gt;</strong>
OUT OF SERVICE?: NO// <strong>&lt;enter&gt;</strong>
REQUIRED VOLUME SET?: NO// <strong>&lt;enter&gt;</strong>
TASKMAN FILES UCI: VAH// <strong>&lt;enter&gt;</strong>
TASKMAN FILES VOLUME SET: ROU// <strong>&lt;enter&gt;</strong>
REROUCEMENT VOLUME SET: <strong>&lt;enter&gt;</strong>
DAYS TO KEEP OLD TASKS: 4// <strong>14</strong>
SIGNON/PRODUCTION VOLUME SET: Yes// <strong>&lt;enter&gt;</strong>
RE-QUEUES BEFORE UN-SCHEDULE: 12// <strong>&lt;enter&gt;</strong>

Select VOLUME SET: <strong>&lt;enter&gt;</strong></code></div>
<p>The next step sets the Taskman parameters:</p>
<div class="code"><code>Select OPTION: <strong>1</strong>  ENTER OR EDIT FILE ENTRIES

Input to what File: UCI ASSOCIATION// 14.7  TASKMAN SITE PARAMETERS
                                          (1 entry)
EDIT WHICH FIELD: ALL// <strong>&lt;enter&gt;</strong>

Select TASKMAN SITE PARAMETERS BOX-VOLUME PAIR: <strong>`1</strong> 
BOX-VOLUME PAIR: PLA:PLAISCSVR// <strong>?</strong>  ; Type a ? to see what is the correct value you should enter.
     Answer must be 3-30 characters in length.

     The value for the current account is ROU:Macintosh
BOX-VOLUME PAIR: PLA:PLAISCSVR// <strong>ROU:Macintosh</strong> ; Enter that value.
RESERVED: <strong>&lt;enter&gt;</strong>
LOG TASKS?: NO// <strong>@</strong>
   SURE YOU WANT TO DELETE? <strong>y</strong>  (Yes)
DEFAULT TASK PRIORITY: <strong>&lt;enter&gt;</strong>
TASK PARTITION SIZE: <strong>&lt;enter&gt;</strong>
SUBMANAGER RETENTION TIME: 0// <strong>&lt;enter&gt;</strong>
TASKMAN JOB LIMIT: 100// <strong>24</strong> ; Must be 80% of maximum; in our case that's 30.
TASKMAN HANG BETWEEN NEW JOBS: 1// <strong>0</strong> ; No need to throttle process creation.
MODE OF TASKMAN: GENERAL PROCESSOR// <strong>&lt;enter&gt;</strong>
VAX ENVIROMENT FOR DCL: <strong>&lt;enter&gt;</strong>
OUT OF SERVICE: NO// <strong>&lt;enter&gt;</strong>
MIN SUBMANAGER CNT: 5// <strong>1</strong> ; Change that to 1
TM MASTER: <strong>&lt;enter&gt;</strong>
Balance Interval: <strong>&lt;enter&gt;</strong>
LOAD BALANCE ROUTINE: <strong>&lt;enter&gt;</strong>
Auto Delete Tasks: <strong>Y</strong>  Yes ; Delete Tasks automatically
Manager Startup Delay: <strong>1</strong> ; Don't wait to start the Manager when first starting.

Select TASKMAN SITE PARAMETERS BOX-VOLUME PAIR: <strong>&lt;enter&gt;</strong></code></div>
<h2 id="kernel-set-up">Kernel Set-Up</h2>
<p>We are not done with setting Taskman up yet; but we need to fix the Volume multiple and several other items our in the Kernel System Parameters file first:</p>
<ul>
<li>AGENCY CODE = EHR (We are not running this inside of the VA)</li>
<li>VOLUME SET:VOLUME SET = ROU</li>
<li>VOLUME SET:MAX SIGNON ALLOWED = 30 (That's the maximum number of processes allowed to run)</li>
<li>VOLUME SET:LOG SYSTEM RT? = @ (delete)</li>
<li>DNS IP = Your DNS Server, or a public one</li>
<li>DEFAULT AUTO-MENU = YES (print menus automatically)</li>
<li>INTRO MESSSAGE (word-processing) = Put whatever you want here. This is what users see when they log-on.</li>
<li>PRIMARY HFS DIRECTORY = Default directory where to write things to. Put an appropriate directory for your OS.</li>
</ul>
<div class="code"><code>><strong>D Q^DI</strong>

VA Fileman 22.2

Select OPTION: <strong>1</strong>  ENTER OR EDIT FILE ENTRIES

Input to what File: UCI ASSOCIATION// <strong>KERNEL SYSTEM PARAMETERS</strong>
                                          (1 entry)
EDIT FIELD: <strong>AGENCY</strong> CODE  
THEN EDIT FIELD: <strong>VOLUME</strong> SET    (multiple)
   EDIT WHICH VOLUME SET SUB-FIELD: ALL//<strong>&lt;enter&gt;</strong> 
THEN EDIT FIELD: <strong>DNS</strong> IP  
THEN EDIT FIELD: <strong>DEFAULT</strong> AU
     1   DEFAULT AUTO SIGN-ON  
     2   DEFAULT AUTO-MENU  
CHOOSE 1-2: <strong>2</strong>  DEFAULT AUTO-MENU
THEN EDIT FIELD: <strong>INTRO</strong> MESSAGE    (word-processing)
THEN EDIT FIELD: <strong>PRIMARY</strong> HFS DIRECTORY  
THEN EDIT FIELD: <strong>&lt;enter&gt;</strong>

Select KERNEL SYSTEM PARAMETERS DOMAIN NAME: <strong>`1</strong> DEMO.OSEHRA.ORG
         ...OK? Yes// <strong>&lt;enter&gt;</strong>  (Yes)

AGENCY CODE: VA// <strong>E</strong>  EHR
Select VOLUME SET: PLA// <strong>@</strong>
   SURE YOU WANT TO DELETE THE ENTIRE 'PLA' VOLUME SET? Y  (Yes)
Select VOLUME SET: <strong>ROU</strong>
  Are you adding 'ROU' as a new VOLUME SET? No// <strong>Y</strong>  (Yes)
  MAX SIGNON ALLOWED: <strong>30</strong>
  LOG SYSTEM RT?:<strong>&lt;enter&gt;</strong>
Select VOLUME SET: 
DNS IP: 127.0.0.1,127.0.0.12  Replace <strong>...</strong> With <strong>8.8.8.8</strong>
  Replace 
   8.8.8.8
DEFAULT AUTO-MENU: NO// <strong>Y</strong>  YES
INTRO MESSAGE:
  1>NEW SYSTEM 304-262-7078
EDIT Option: <strong>1</strong>
  1>NEW SYSTEM 304-262-7078
  Replace <strong>...</strong> With <strong>This is my test system.</strong>  Replace 
   This is my test system.
Edit line: <strong>&lt;enter&gt;</strong>
EDIT Option: <strong>&lt;enter&gt;</strong>
PRIMARY HFS DIRECTORY: /tmp/// <strong>&lt;enter&gt;</strong>


Select KERNEL SYSTEM PARAMETERS DOMAIN NAME:</code></div>
<h2 id="back-to-taskman">Back to Taskman</h2>
<p>At this point, we are ready to go back to getting Taskman to run. We will now run <code>^ZTMCHK</code> which checks our work and makes sure we didn't screw up royally.</p>
<div class="code"><code>><strong>D ^ZTMCHK</strong>
Checking Task Manager's Environment.

Checking Taskman's globals...
     ^%ZTSCH is defined!
     ^%ZTSK is defined!
     ^%ZTSK(-1) is defined!
     ^%ZIS(14.5,0) is defined!
     ^%ZIS(14.6,0) is defined!
     ^%ZIS(14.7,0) is defined!

Checking the ^%ZOSF nodes required by Taskman...
     All ^%ZOSF nodes required by Taskman are defined!

Checking the links to the required volume sets...
     There are no volume sets whose links are required!

Checks completed...Taskman's environment is okay!

Press RETURN to continue or '^' to exit: 

Here is the information that Taskman is using:
     Operating System:  GT.M (Unix)
     Volume Set:  ROU
     Cpu-volume Pair:  ROU:Macintosh
     Taskman Files UCI and Volume Set:  VAH,ROU

     Log Tasks?  
     Submanager Retention Time: 0
     Min Submanager Count: 1
     Taskman Hang Between New Jobs: 0
     Taskman running as a type: GENERAL

     Logons Inhibited?:  N
     Taskman Job Limit:  24
     Max sign-ons: 30
     Current number of active jobs: 1

End of listing.  Press RETURN to continue:</code></div>
<p>If ANY of the fields in the last screen are empty, except &quot;Log Tasks?&quot;, you made a mistake. Double check your work.</p>
<p>Next we need to initialize the recurring and start-up tasks that VistA will run. The set of tasks you want your system to run with is very variable; you can see this page for guidance: <a href="http://www.vistapedia.com/index.php/Taskman_Recurring_Tasks" class="uri">http://www.vistapedia.com/index.php/Taskman_Recurring_Tasks</a>. We will set these base tasks, which every VistA system ought to have, up on your VistA system:</p>
<p>Start-up Jobs:</p>
<ul>
<li>XWB LISTENER STARTER (Starts RPC Broker)</li>
<li>XOBV LISTENER STARTUP (Starts VistALink Broker)</li>
<li>XUSER-CLEAR-ALL (Cleans signed on users for a system that just got booted)</li>
<li>XUDEV RES-CLEAR (Clear resource devices for a system that just got booted)</li>
<li>XMMGR-START-BACKGROUND-FILER (Start mailman background processor)</li>
</ul>
<p>Nightly Jobs:</p>
<ul>
<li>XMAUTOPURGE (Delete unreferenced mail messages)</li>
<li>XMCLEAN (Delete from system messages deleted by users)</li>
<li>XMMGR-PURGE-AI-XREF (Delete duplicate network messages)</li>
<li>XQBUILDTREEQUE (Rebuild the menus in the menu system)</li>
<li>XQ XUTL $J NODES (IMPORTANT: Delete left over temp globals from process activity)</li>
<li>XUERTRP AUTO CLEAN (Cleans the error trap after 7 days)</li>
<li>XUTM QCLEAN (Clean Task file from completed tasks if the task didn't delete itself after it ran)</li>
</ul>
<p>Beyond these tasks, which tasks you run depends on what's important to you: if you write notes, you will want TIU tasks; if you use Drug Accountability, you will want PSA tasks; etc.</p>
<p>FOIA VistA comes with a lot of junk, so I advise starting from a clean slate. Be careful with the next few commands: they should never be run on an existing system, otherwise they may delete patient data:</p>
<div class="code"><code>><strong>K ^%ZTSK,^%ZTSCH</strong> ; clean taskman Globals
><strong>D DT^DICRW S DIK="^DIC(19.2," F DA=0:0 S DA=$O(^DIC(19.2,DA)) Q:'DA  D ^DIK</strong> ; Delete all tasks</code></div>
<p>Next add the tasks outlined above to OPTION SCHEDULING (#19.2). The startup entries will only need the NAME and SPECIAL QUEUING fields; the nightly jobs will need NAME, QUEUED TO RUN AT WHAT TIME, and RESCHEDULING FREQUENCY fields.</p>
<div class="code"><code>><strong>S DUZ=.5 D Q^DI</strong>
Select OPTION:    <strong>ENTER OR EDIT FILE ENTRIES</strong>

Input to what File: KERNEL SYSTEM PARAMETERS// <strong>OPTION SCHEDULING</strong> (0 entries)
EDIT WHICH FIELD: ALL// <strong>.01</strong>  NAME
THEN EDIT FIELD: <strong>2</strong>  QUEUED TO RUN AT WHAT TIME
THEN EDIT FIELD: <strong>6</strong>  RESCHEDULING FREQUENCY
THEN EDIT FIELD: <strong>9</strong>  SPECIAL QUEUEING
THEN EDIT FIELD: <strong>&lt;enter&gt;</strong>

Select OPTION SCHEDULING NAME: <strong>XWB LISTENER STARTER</strong>       Start All RPC Broker Listeners
  Are you adding 'XWB LISTENER STARTER' as 
    a new OPTION SCHEDULING (the 1ST)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>&lt;enter&gt;</strong>
RESCHEDULING FREQUENCY: <strong>&lt;enter&gt;</strong>
SPECIAL QUEUEING: <strong>S</strong>  STARTUP


Select OPTION SCHEDULING NAME: <strong>XOBV LISTENER STARTUP</strong>       Start VistaLink Listener Configuration
  Are you adding 'XOBV LISTENER STARTUP' as 
    a new OPTION SCHEDULING (the 2ND)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>&lt;enter&gt;</strong>
RESCHEDULING FREQUENCY: <strong>&lt;enter&gt;</strong>
SPECIAL QUEUEING: <strong>S</strong>  STARTUP


Select OPTION SCHEDULING NAME: <strong>XUSER-CLEAR-ALL</strong>       Clear all users at startup
  Are you adding 'XUSER-CLEAR-ALL' as 
    a new OPTION SCHEDULING (the 3RD)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>&lt;enter&gt;</strong>
RESCHEDULING FREQUENCY: <strong>&lt;enter&gt;</strong>
SPECIAL QUEUEING: <strong>S</strong>  STARTUP


Select OPTION SCHEDULING NAME: <strong>XUDEV RES-CLEAR</strong>
  Are you adding 'XUDEV RES-CLEAR' as 
    a new OPTION SCHEDULING (the 4TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>&lt;enter&gt;</strong>
RESCHEDULING FREQUENCY: <strong>&lt;enter&gt;</strong>
SPECIAL QUEUEING: <strong>S</strong>  STARTUP


Select OPTION SCHEDULING NAME: <strong>XMMGR-START-BACKGROUND-FILER</strong>       START background filer
  Are you adding 'XMMGR-START-BACKGROUND-FILER' as 
    a new OPTION SCHEDULING (the 5TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>&lt;enter&gt;</strong>
RESCHEDULING FREQUENCY: <strong>&lt;enter&gt;</strong>
SPECIAL QUEUEING: <strong>S</strong>  STARTUP

Select OPTION SCHEDULING NAME:    <strong>XMAUTOPURGE</strong>
  Are you adding 'XMAUTOPURGE' as 
    a new OPTION SCHEDULING (the 6TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0001</strong>  (DEC 01, 2016@00:01)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong>


Select OPTION SCHEDULING NAME: <strong>XMCLEAN</strong>       Clean out waste baskets
  Are you adding 'XMCLEAN' as a new OPTION SCHEDULING (the 7TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0005</strong>  (DEC 01, 2016@00:05)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong>


Select OPTION SCHEDULING NAME: <strong>XMMGR-PURGE-AI-XREF</strong>      AI x-Ref Purge of Received Network Messages
  Are you adding 'XMMGR-PURGE-AI-XREF' as 
    a new OPTION SCHEDULING (the 8TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0010</strong>  (DEC 01, 2016@00:10)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong>


Select OPTION SCHEDULING NAME: <strong>XQBUILDTREEQUE</strong>       Non-interactive Build Primary Menu Trees
  Are you adding 'XQBUILDTREEQUE' as a new OPTION SCHEDULING (the 9TH)? No// <strong>Y</strong>
  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0015</strong>  (DEC 01, 2016@00:15)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong>


Select OPTION SCHEDULING NAME: <strong>XQ XUTL $J NODES</strong>       Clean old Job Nodes in XUTL
  Are you adding 'XQ XUTL $J NODES' as 
    a new OPTION SCHEDULING (the 10TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0020</strong>  (DEC 01, 2016@00:20)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong>


Select OPTION SCHEDULING NAME: <strong>XUERTRP AUTO CLEAN</strong>       Error trap Auto clean
  Are you adding 'XUERTRP AUTO CLEAN' as 
    a new OPTION SCHEDULING (the 11TH)? No// <strong>Y</strong>  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0025</strong>  (DEC 01, 2016@00:25)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong>


Select OPTION SCHEDULING NAME: <strong>XUTM QCLEAN</strong>       Queuable Task Log Cleanup
  Are you adding 'XUTM QCLEAN' as a new OPTION SCHEDULING (the 12TH)? No// <strong>Y</strong>
  (Yes)
QUEUED TO RUN AT WHAT TIME: <strong>T+1@0030</strong>  (DEC 01, 2016@00:30)
RESCHEDULING FREQUENCY: <strong>1D</strong>
SPECIAL QUEUEING: <strong>&lt;enter&gt;</strong></code></div>
<p>There are actually just two more steps:</p>
<ul>
<li>Run <code>DO ^ZTMB</code> to start Taskman. <em>NOTE THAT IS THIS THE ONLY WAY TO START TASKMAN!</em> Restarting Taskman means that data control structure from the old system will be assumed to be correct. Don't do it!</li>
<li>Run <code>DO ^ZTMON</code> to confirm that everything is running.</li>
</ul>
<p>You should see this (press enter several times to update the screen, it should take at least 1 second to start); to exit, type <code>^</code>.</p>
<div class="code"><code>><strong>D ^ZTMB,^ZTMON</strong>

Checking Taskman.   Current $H=64252,53277  (Nov 30, 2016@14:47:57)
                      RUN NODE=64252,53274  (Nov 30, 2016@14:47:54)
Taskman is current..
Checking the Status List:
  Node        weight  status      time       $J
 ROU:Macintosh        RUN      T@14:47:54   81569     Main Loop

Checking the Schedule List:
     Taskman has 3 tasks scheduled.
     None of them are overdue.

Checking the IO Lists:  Last TM scan: 2 sec, 
     There are no tasks waiting for devices.

Checking the Job List:
     There are no tasks waiting for partitions.

Checking the Task List:
     There are no tasks currently running.
Checking Sub-Managers:
     On node ROU:Macintosh there is  1 free Sub-Manager(s). Status: Run</code></div>
<p>On CACHE, you can run <code>D THIS^%SS</code> to find out what started; on GT.M/YottaDB, you should have a ZSY which does the same thing. If ZSY isn't present on your instance, you can do something similar to the following until you find a ZSY:</p>
<p>Cache:</p>
<div class="code"><code>><strong>D THIS^%SS</strong>

                   Cache System Status:  3:16 pm 30 Nov 2016
 Process  Device      Namespace      Routine         CPU,Glob  Pr User/Location
   72316* /dev/ttys004FOIA1611       shell       3506713,3993500  UnknownUser
   85180  /dev/null   FOIA1611       %ZTM          11266,1562  0  UnknownUser
   85393  /dev/null   FOIA1611       %ZTMS1         5177,203   0  UnknownUser
   85404  /dev/null   FOIA1611       %ZTMS1         5177,203   0  UnknownUser
   85218  /dev/null   FOIA1611       %ZTMS1         5288,214   0  UnknownUser
   85230  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85242  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85254  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85266  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85269  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85295  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85398  /dev/null   FOIA1611       %ZTMS1         5177,203   0  UnknownUser
   85409  /dev/null   FOIA1611       %ZTMS1         5177,203   0  UnknownUser
   85414  /dev/null   FOIA1611       %ZTMS1         5063,187   0  UnknownUser
   85342  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85348  /dev/null   FOIA1611       %ZTMS1         5287,214   0  UnknownUser
   85354  /dev/null   FOIA1611       %ZTMS1         5177,203   0  UnknownUser
   85359  /dev/null   FOIA1611       %ZTMS1         5177,203   0  UnknownUser
   85419  /dev/null   FOIA1611       %ZTMS1         5063,187   0  UnknownUser
   85424  /dev/null   FOIA1611       %ZTMS1         5063,187   0  UnknownUser
   85430  /dev/null   FOIA1611       %ZTMS1         5063,187   0  UnknownUser
   85435  /dev/null   FOIA1611       %ZTMS1         5063,187   0  UnknownUser
   85441  /dev/null   FOIA1611       %ZTMS1         5063,187   0  UnknownUser</code></div>
<p>GT.M/YottaDB:</p>
<p><code>DO ^ZSY</code>.</p>
<div class="code"><code>
Proc. id Proc. name      PS  Device   Routine            MODE     CPU time
-------- --------------- --- -------- --------           -------  
8757     Sub 8757        hib          GETTASK+3^%ZTMS1   -direct  00:00:00
                             0 OPEN RMS STREAM NOWRAP :
                             0-out OPEN RMS STREAM NOWRAP :
8771                     S+  pts/1    JOBSET+9^ZSY       -dir     00:00:00
                             /dev/pts/1 OPEN TERMINAL CTRA=$C(3) NOPAST NOESCA 
                             ps OPEN PIPE SHELL="/bin/sh" COMMAND="ps eo pid,tt
28250    Taskman ROU 1   hib          IDLE+3^%ZTM        -direct  00:55:38
                             0 OPEN RMS STREAM NOWRAP :
                             0-out OPEN RMS STREAM NOWRAP :
28311    BTask 619367    hib          GO+12^XMTDT        -direct  00:06:54
                             0 OPEN RMS STREAM NOWRAP :
                             0-out OPEN RMS STREAM NOWRAP :
29662    BTask 619368    hib          GO+26^XMKPLQ       -direct  00:06:39
                             0 OPEN RMS STREAM NOWRAP :
                             0-out OPEN RMS STREAM NOWRAP :

Total 5 users.</code></div>
<p>If you don't have ^ZSY on GT.M/YottaDB, try this: it does what ZSY does:</p>
<div class="code"><code>><strong>K ^XUTL("XUSYS")</strong>
><strong>zsy "kill -SIGUSR1 $(lsof -t ${vista_home}/g/mumps.dat)"</strong>

><strong>zwrite ^XUTL("XUSYS",:,"JE","INTERRUPT")</strong>
^XUTL("XUSYS",1565,"JE","INTERRUPT")="IDLE+3^%ZTM"
^XUTL("XUSYS",2236,"JE","INTERRUPT")="GO+26^XMKPLQ"
^XUTL("XUSYS",2667,"JE","INTERRUPT")="GO+12^XMTDT"
^XUTL("XUSYS",9259,"JE","INTERRUPT")="+1^GTM$DMOD"
^XUTL("XUSYS",18658,"JE","INTERRUPT")="GETTASK+3^%ZTMS1"
</code></div>
<h2 id="setup-your-institution">Setup your Institution</h2>
<p>VistA has a very complex structure to deal with the question of: in what hospital are you signed in right now? The answer determines the value of the all important variable <code>DUZ(2)</code> and the API <code>SITE^VASITE()</code>.</p>
<p>There are five files that are important in that regard: INSTITUTION (#4), STATION NUMBER (TIME SENSITIVE) (#389.9), KERNEL SYSTEM PARAMETERS (#8989.3), MEDICAL CENTER DIVISION file (#40.8), and MASTER PATIENT INDEX (LOCAL NUMBERS) (984.1). We will add our Hospital to the INSTITUTION file first, with the station number 999. Then we will make sure that the STATION NUMBER file says 999; and then will will point the KERNEL SYSTEM PARAMETERS and MEDICAL CENTER DIVISION to our new Hospital. In MASTER PATIENT INDEX, we tell it our station number and the range of numbers for our Integration Control Numbers (ICNs), the number used to identify patients across systems.</p>
<p>By default, FOIA VistA comes with station number 050, and the institution is called SOFTWARE SERVICE. We can't leave that alone because VistA malfunctions with station numbers are are just 2 digits long (050 becomes 50 in code).</p>
<p>The INSITUTION file is protected from editing by requiring the variable XUMF to be defined. That tells us that inside of the VA, the file is updated by something called Standard Terminology Services (STS), which works by sending VistA mail messages of what to update, and VistA creates the entry based on that mail message. Normally when you see that, you should stay the hell out of the file: it's standardized and should not be tampered with. However, people outside of the VA have no other way to run VistA without updating this file.</p>
<p>We enter Fileman after setting the XUMF variable. Note that in the US, we are supposed to fill the NPI variable, and Fileman won't let me go further without filling it; but I was able to jump forward to avoid answering it. Also, note that we have to fill the STATION NUMBER entry twice, once in the field named so, and another time in the coding system multiple.</p>
<div class="code"><code>><strong>S DUZ=.5,XUMF=1 D Q^DI</strong>


VA Fileman 22.2


Select OPTION: <strong>ENTER OR EDIT FILE ENTRIES</strong> 



Input to what File: OPTION SCHEDULING// <strong>4</strong>  INSTITUTION
                                          (2535 entries)

EDIT WHICH FIELD: ALL// <strong>NAME</strong>  
THEN EDIT FIELD: <strong>STATE</strong>
     1   STATE  
     2   STATE (MAILING)  
CHOOSE 1-2: <strong>1</strong>  STATE
THEN EDIT FIELD: <strong>SHORT</strong> NAME  
THEN EDIT FIELD: <strong>.06</strong>  VA TYPE CODE
THEN EDIT FIELD: <strong>1.01</strong>  STREET ADDR. 1
THEN EDIT FIELD: <strong>1.02</strong>  STREET ADDR. 2
THEN EDIT FIELD: <strong>1.03</strong>  CITY
THEN EDIT FIELD: <strong>1.04</strong>  ZIP
THEN EDIT FIELD: <strong>5</strong>  MULTI-DIVISION FACILITY
THEN EDIT FIELD: <strong>11</strong>  STATUS
THEN EDIT FIELD: <strong>41.99</strong>  NPI
THEN EDIT FIELD: <strong>52</strong>  FACILITY DEA NUMBER
THEN EDIT FIELD: <strong>52.1</strong>  FACILITY DEA EXPIRATION DATE
THEN EDIT FIELD: <strong>60</strong>  DOMAIN
THEN EDIT FIELD: <strong>95</strong>  AGENCY CODE
THEN EDIT FIELD: <strong>99</strong>  STATION NUMBER
THEN EDIT FIELD: <strong>9999</strong>  IDENTIFIER  (multiple)
   EDIT WHICH IDENTIFIER SUB-FIELD: ALL// <strong>&lt;enter&gt;</strong>

Select INSTITUTION NAME: <strong>PALM DESERT HOSPITAL</strong>
  Are you adding 'PALM DESERT HOSPITAL' as a new INSTITUTION (the 2536TH)? No// <strong>Y</strong>
  (Yes)
STATE: <strong>CA</strong>
     1   CALIFORNIA  
     2   CANADA  
CHOOSE 1-2: <strong>1</strong>  CALIFORNIA
SHORT NAME: <strong>PDH</strong>??
     ANSWER MUST BE 4-80 CHARACTERS IN LENGTH
SHORT NAME: <strong>PALDH</strong>
VA TYPE CODE: <strong>MC</strong>  HOSP
STREET ADDR. 1: <strong>111 ANY LANE</strong>
STREET ADDR. 2: <strong>&lt;enter&gt;</strong>
CITY: <strong>PALM DESERT</strong> 
ZIP: <strong>92211</strong>
MULTI-DIVISION FACILITY: <strong>N</strong>  NO
STATUS: <strong>N</strong>  National
NPI: <strong>&lt;enter&gt;</strong>??
     Answer must be 10 characters in length and not being used.
NPI: <strong>&lt;enter&gt;</strong>?
     Answer must be 10 characters in length and not being used.
NPI: <strong>^FACIL</strong>
     1   FACILITY DEA EXPIRATION DATE  
     2   FACILITY DEA NUMBER  
     3   FACILITY TYPE  
CHOOSE 1-3: <strong>2</strong>  FACILITY DEA NUMBER
FACILITY DEA NUMBER: <strong>&lt;enter&gt;</strong>
FACILITY DEA EXPIRATION DATE: <strong>&lt;enter&gt;</strong>
DOMAIN: <strong>DEMO.OSEHRA.ORG</strong>  
AGENCY CODE: <strong>E</strong>  EHR
STATION NUMBER: <strong>999</strong>
Select CODING SYSTEM: <strong>VASTANUM</strong>
   CODING SYSTEM ID: <strong>999</strong>
  ID: 999// <strong>&lt;enter&gt;</strong>
  EFFECTIVE DATE/TIME: <strong>N</strong>  (DEC 03, 2016)
  STATUS: <strong>?</strong>
     Choose from: 
       1        ACTIVE
       0        INACTIVE
  STATUS: <strong>1</strong>  ACTIVE


Select INSTITUTION NAME: <strong>&lt;enter&gt;</strong></code></div>
<p>Next, we will tackle the STATION NUMBER file. We technically can create an new entry, but I would just rather reuse the existing entry, which I do by typing <code>`1</code>.</p>
<div class="code"><code>Select OPTION: <strong>EN</strong>TER OR EDIT FILE ENTRIES  



Input to what File: INSTITUTION// <strong>STATION NUMBER</strong> (TIME SENSITIVE)  
                                          (1 entry)
EDIT WHICH FIELD: ALL// <strong>&lt;enter&gt;</strong>


Select STATION NUMBER (TIME SENSITIVE) REFERENCE NUMBER: <strong>?</strong>
    Answer with STATION NUMBER (TIME SENSITIVE), or REFERENCE NUMBER, or
        EFFECTIVE DATE, or MEDICAL CENTER DIVISION:
   50        01-01-82     DBA     050

        You may enter a new STATION NUMBER (TIME SENSITIVE), if you wish
        Type a Number between 1 and 9999, 0 Decimal Digits

Select STATION NUMBER (TIME SENSITIVE) REFERENCE NUMBER: <strong>`1</strong>  50     01-01-82    
 DBA     050
REFERENCE NUMBER: 50// <strong>999</strong>
EFFECTIVE DATE: JAN 1,1982// <strong>&lt;enter&gt;</strong>
MEDICAL CENTER DIVISION: DBA// <strong>?</strong>
    Answer with MEDICAL CENTER DIVISION NUM, or NAME, or FACILITY NUMBER, or
        TREATING SPECIALTY:
   1            DBA     050

MEDICAL CENTER DIVISION: DBA// <strong>&lt;enter&gt;</strong>
STATION NUMBER: 050// <strong>999</strong>
IS PRIMARY DIVISION: YES// <strong>&lt;enter&gt;</strong>
INACTIVE: <strong>&lt;enter&gt;</strong>
OTHER INSTITUTION: <strong>&lt;enter&gt;</strong>
INTEGRATION NAME: <strong>&lt;enter&gt;</strong>

Select STATION NUMBER (TIME SENSITIVE) REFERENCE NUMBER: <strong>&lt;enter&gt;</strong></code></div>
<p>Next, the KERNEL SYSTEM PARAMETERS file:</p>
<div class="code"><code>Select OPTION: <strong>EN</strong>TER OR EDIT FILE ENTRIES  



Input to what File: STATION NUMBER (TIME SENSITIVE)// <strong>KERNEL SYSTEM PARAMETERS</strong>  
                                          (1 entry)
EDIT WHICH FIELD: ALL// <strong>DEFAULT INSTITUTION</strong>  
THEN EDIT FIELD: <strong>&lt;enter&gt;</strong>


Select KERNEL SYSTEM PARAMETERS DOMAIN NAME: <strong>`1</strong>  DEMO.OSEHRA.ORG
DEFAULT INSTITUTION: SOFTWARE SERVICE// <strong>PALM DES</strong>
     1   PALM DESERT CBOC      CA  CBOC      605GC  
     2   PALM DESERT HOSPITAL    CA          999  
CHOOSE 1-2: <strong>2</strong>  PALM DESERT HOSPITAL  CA      999  


Select KERNEL SYSTEM PARAMETERS DOMAIN NAME: <strong>&lt;enter&gt;</strong></code></div>
<p>Next, the MEDICAL CENTER DIVISION file:</p>
<div class="code"><code>Select OPTION: <strong>EN</strong>TER OR EDIT FILE ENTRIES  

Input to what File: KERNEL SYSTEM PARAMETERS// <strong>MEDICAL CENTER DIVISION</strong>  
                                          (1 entry)

EDIT WHICH FIELD: ALL// <strong>.01</strong>  NAME
THEN EDIT FIELD: <strong>.07</strong>  INSTITUTION FILE POINTER
THEN EDIT FIELD: <strong>1</strong>  FACILITY NUMBER



Select MEDICAL CENTER DIVISION NAME: <strong>`1</strong>  DBA     050
NAME: DBA// <strong>MAIN CAMPUS</strong>
INSTITUTION FILE POINTER: SOFTWARE SERVICE// <strong>PALM DESERT HOSPITAL</strong>    CA    999  
FACILITY NUMBER: 050// <strong>999</strong>


Select MEDICAL CENTER DIVISION NAME:<strong>&lt;enter&gt;</strong></code></div>
<p>Next, the MASTER PATIENT INDEX file:</p>
<div class="code"><code>Select OPTION: <strong>EN</strong>TER OR EDIT FILE ENTRIES

INPUT TO WHAT FILE: MASTER PATIENT INDEX (LOCAL NUMBERS)// <strong>MASTER PATIENT INDEX</strong>

EDIT WHICH FIELD: ALL//

Select MASTER PATIENT INDEX (LOCAL NUMBERS) SITE ID NUMBER: <strong>`1</strong>  740
SITE ID NUMBER: 740// <strong>999</strong>
LAST NUMBER USED: 500000000// <strong>9990000000</strong>
CHECK SUM FOR LAST NUMBER USED: 217407// <strong>@</strong>
SURE YOU WANT TO DELETE? <strong>Y</strong>  (Yes)
NEXT NUMBER TO USE: 500000001// <strong>9990000001</strong>
CHECK SUM FOR NEXT: 075322// <strong>@</strong>
SURE YOU WANT TO DELETE? <strong>Y</strong>  (Yes)


Select MASTER PATIENT INDEX (LOCAL NUMBERS) SITE ID NUMBER:<strong>&lt;enter&gt;</strong></code></div>
<p>At this point, we are ready to check our work. First, we need to know the internal entry number (IEN) of the institution we just created:</p>
<div class="code"><code>Select OPTION: <strong>INQ</strong>UIRE TO FILE ENTRIES


Output from what File: MEDICAL CENTER DIVISION// <strong>4</strong>  INSTITUTION
                                          (2536 entries)
Select INSTITUTION NAME: <strong>&lt;spacebar&gt;&lt;enter&gt;</strong>   PALM DESERT HOSPITAL  CA    999  
Another one: <strong>&lt;enter&gt;</strong>
Standard Captioned Output? Yes// <strong>N</strong>  (No)
First Print FIELD: <strong>NUMBER</strong>
Then Print FIELD: <strong>&lt;enter&gt;</strong>
Heading (S/C): INSTITUTION List// <strong>&lt;enter&gt;</strong>
INSTITUTION List                                     DEC 03, 2016@20:33   PAGE 1
NUMBER
--------------------------------------------------------------------------------

2957</code></div>
<p>Okay, let's kill our symbol table (the table that keeps our current variables), log-in, and then run <code>$$SITE^VASITE</code>.</p>
<div class="code"><code>><strong>K  S DUZ=.5 D ^XUP</strong>

Setting up programmer environment
This is a TEST account.

Terminal Type set to: C-VT100

Select OPTION NAME: <strong>&lt;enter&gt;</strong>
><strong>W DUZ(2)</strong>
2957
><strong>W $$SITE^VASITE()</strong>
2957^PALM DESERT HOSPITAL^999</code></div>
<p>As you can see, our DUZ(2) matches our site number, and $$SITE^VASITE() gives us the correct site number and station number.</p>
<h2 id="setup-rpc-broker">Setup RPC Broker</h2>
<p>Next, we set-up a port for CPRS to connect. CPRS connects to the Remote Procedure Calls Broker, and it connects using Remote Procedures. The next step is to edit entries in the RPC Broker Site Parameters file. The RPC Broker steps will set up information that references both the Port that the listener will listen on and the Box Volume pair of the instance.</p>
<div class="code"><code>><strong>S DUZ=.5 D Q^DI</strong>

VA Fileman 22.0

Select OPTION: <strong>1</strong>  ENTER OR EDIT FILE ENTRIES

INPUT TO WHAT FILE: VOLUME SET// <strong>8994.1</strong>  RPC BROKER SITE PARAMETERS
                                         (1 entry)
EDIT WHICH FIELD: ALL// <strong>LISTENER</strong>    (multiple)
    EDIT WHICH LISTENER SUB-FIELD: ALL// <strong>&lt;enter&gt;</strong>
THEN EDIT FIELD: <strong>&lt;enter&gt;</strong>

Select RPC BROKER SITE PARAMETERS DOMAIN NAME: <strong>DEMO.OSEHRA.ORG</strong>
        ...OK? Yes// <strong>Y</strong>   (Yes)

Select BOX-VOLUME PAIR: VISTA:CACHE// <strong>&lt;enter&gt;</strong>
  BOX-VOLUME PAIR: VISTA:CACHE//
  Select PORT: <strong>9000</strong>
  Are you adding '9000' as a new PORT (the 1ST for this LISTENER)? No// <strong>Y</strong>  (Yes)
    TYPE OF LISTENER: <strong>1</strong>  New Style
  STATUS: STOPPED// 
  CONTROLLED BY LISTENER STARTER: <strong>Y</strong>  YES


Select RPC BROKER SITE PARAMETERS DOMAIN NAME: <strong>&lt;enter&gt;</strong></code></div>
<p>Now, start the listener:</p>
<div class="code"><code>><strong>D ^XUP</strong>

Setting up programmer environment
This is a TEST account.

Terminal Type set to: C-VT100

Select OPTION NAME: <strong>XWB LISTEN</strong>
     1   XWB LISTENER EDIT       RPC Listener Edit
     2   XWB LISTENER STARTER       Start All RPC Broker Listeners
     3   XWB LISTENER STOP ALL       Stop All RPC Broker Listeners
CHOOSE 1-3: <strong>2</strong>  XWB LISTENER STARTER     Start All RPC Broker Listeners
Start All RPC Broker Listeners
          Task: RPC Broker Listener START on VAH-ROU:Macintosh, port 9000
          has been queued as task 32372</code></div>
<p>Finally, we need to check that the broker started. While you may use ^%SS or ^ZSY to find that out, I prefer OS level tools that show me that the port is active.</p>
<p>On Mac or Linux, you can run <code>lsof -iTCP -sTCP:LISTEN -P</code>; on Linux, <code>netstat -tnlp</code>; on Windows (including Cygwin), <code>netstat -aon | find /i &quot;listening&quot;</code>. Here's an example output on a Mac:</p>
<div class="code"><code>$ lsof -iTCP -sTCP:LISTEN -P
COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
mumps   85939  sam    6u  IPv6 0x5ee953ac0e7fceab      0t0  TCP \*:9000 (LISTEN)</code></div>
<p>If you shut down your system and then bring it back up, starting Taskman using <code>^ZTMB</code> will start your broker, as we set it up as one of the startup tasks.</p>
<p>Back to business: To check that the RPC Broker is REALLY working, run <code>DO ^XWBTCPMT</code>.</p>
<div class="code"><code>><strong>D ^XWBTCPMT</strong>

Interactive Broker Test
IP ADDRESS: <strong>127.0.0.1</strong>
PORT: <strong>9000</strong>

Success, response: accept</code></div>
<p>Our response was &quot;Success&quot;. If you don't succeed, you may get &quot;Fail&quot;. If that happens, refer to this page on troubleshooting the Broker in Vistapedia: <a href="http://www.vistapedia.com/index.php/VISTA_XWB_Broker_Troubleshooting" class="uri">http://www.vistapedia.com/index.php/VISTA_XWB_Broker_Troubleshooting</a>.</p>
<p>To stop the broker, <code>do ^XUP</code>, and then choose <code>XWB LISTENER STOP ALL</code>:</p>
<div class="code"><code>><strong>D ^XUP</strong>
Setting up programmer environment
This is a TEST account.

Terminal Type set to: C-VT100

Select OPTION NAME: <strong>XWB LISTENER STOP ALL</strong>       Stop All RPC Broker Listeners
Stop All RPC Broker Listeners</code></div>
<p>If you run <code>lsof -iTCP -sTCP:LISTEN -P</code> again, you won't see any output.</p>
<p>Independent of our set-up above, we can start the broker at any port we want from direct mode using <code>J ZISTCP^XWBTCPM1(&lt;port no&gt;)</code>.</p>
<p>To test the broker from the client side, you can download the Broker SDK from the FOIA site: <a href="http://foia-vista.osehra.org/Patches_By_Application/XWB-RPC%20BROKER/XWB_1_1_P60_scrubbed.zip">http://foia-vista.osehra.org/Patches_By_Application/XWB-RPC%20BROKER/XWB_1_1_P60_scrubbed.zip</a></p>
<p>Once you unzip it, you will find this file: <code>./Samples/BrokerEx/BrokerExample.exe</code>. Run this, replace the server name and port with your ip address and port, and then click on connect.</p>
<figure>
<img src="images/InitializeVistA/pic38.png" class="align-center" />
</figure>
<p>Once you click connect, you will see the sign-in dialog: That means that the broker is functional.</p>
<figure>
<img src="images/InitializeVistA/pic37.png" class="align-center" />
</figure>
<p>Note: Because of the <a href="https://groups.google.com/forum/#!msg/hardhats/tmuguZ1GK7k/at_0i82n-zgJ">infamous XUSRB1.m problem</a>, you won't be able to log-on right now. But you should be able to using CPRS.</p>
<h2 id="set-yourself-up-as-the-system-manager">Set Yourself Up as the System Manager</h2>
<p>This is a super user who will have elevated privileges. You can add other users such as Physicians, Pharmacists, etc. later. Set up the System Manager user with minimal information. We will add more information later. By convention, the super user has a DUZ of 1. So far we have been using the DUZ of .5. We have to use it one last time to make the system manager. Your access code is really your username. I set it up as SM1234, but you can put whatever you like. Go back into Fileman using <code>S DUZ=.5 D Q^DI</code>:</p>
<div class="code"><code>Select OPTION: <strong>1</strong>   ENTER OR EDIT FILE ENTRIES

INPUT TO WHAT FILE: RPC BROKER PARAMETERS// <strong>200</strong>   NEW PERSON
          (2 entries)
EDIT WHICH FIELD: ALL// <strong>.01</strong>   NAME
THEN EDIT FIELD: <strong>ACCESS CODE</strong>   Want to edit ACCESS CODE (Y/N)
THEN EDIT FIELD: <strong>&lt;enter&gt;</strong>

Select NEW PERSON NAME: <strong>`1</strong>  USER,ONE
NAME: USER,ONE// <strong>MANAGER,SYSTEM</strong>
Want to edit ACCESS CODE (Y/N): <strong>Y</strong>
Enter a new ACCESS CODE <Hidden>: <strong>******</strong>
Please re-type the new code to show that I have it right: <strong>******</strong>
OK, Access code has been changed!
The VERIFY CODE has been deleted as a security measure.
The user will have to enter a new one the next time they sign-on.

Select NEW PERSON NAME: <strong>&lt;enter&gt;</strong></code></div>
<p>Next give your user privileges appropriate for a system manager. This brings us to VistA's security system.</p>
<p>VistA menu tree is built just like the Windows Registry: Folders (known as menus) which contain other folders or actual items which you can run. Each menu is like a door: it has a &quot;key&quot; which locks it; or it could be one of those sliding doors which doesn't have keys. A key to a door (ahem, menu) protects all the subsequent doors beyond the first door. If you lock the first door, you can keep the doors below it open. When we ran <code>DO ^XUP</code>, what we really did was that we went into the menu system.</p>
<p>Keys are also checked by runtime code in order to give privileges when performing certain operations. It's a very common practice in VistA for all users to have access to something, but only the holders of specific keys can perform certain actions. For example, all Lab users have &quot;LRLAB&quot;; but only those credentialed as Lab Technicians will have &quot;LRVERIFY&quot; to release the result.</p>
<p>Let's enlarge our analogy a bit: Users of the VistA system can be assigned a specific door to enter into: This is known as their PRIMARY MENU. A prevalent practice is to give everybody the PRIMARY MENU of <code>XUCORE</code>, which is analogous to a City Portal. Once you say who you are (ACCESS CODE) and your password (VERIFY CODE), you enter the City (XUCORE) and you can only enter the building for which you have the key.</p>
<p>What we do below is a couple of things: We give ourselves the Fileman Access Code (different from ACCESS CODE) of &quot;@&quot;, which gives you the equivalent of root privileges in Fileman. Next, we give ourselves the keys <code>XUMGR</code> (let's you add users and manipulate tasks); <code>XUPROG</code> (let's you edit users [don't ask me why--I have no clue why they put that key there], and install Software); <code>XUPROGMODE</code> (let's you enter programmer mode); <code>XMMGR</code> (let's you manage mailman), <code>XUSPF200</code> (let's you add users without requiring an SSN). By the way, privileged users can be given the ability to add new users and assign and take away keys using a mechanism called delegation. I won't cover that here.</p>
<div class="code"><code>><strong>S DUZ=1</strong>
><strong>S $P(^VA(200,DUZ,0),"^",4)="@"</strong>
><strong>D ^XUP</strong>

Setting up programmer environment
Select TERMINAL TYPE NAME: <strong>C-VT320</strong>
Terminal Type set to: C-VT320

Select OPTION NAME: <strong>XUMAINT</strong> Menu Management

Select Menu Management Option: <strong>KEY</strong> Management

Select Key Management Option: <strong>ALLO</strong>cation of Security Keys

Allocate key: <strong>XUMGR</strong>

Another key: <strong>XUPROG</strong>
   1   XUPROG
   2   XUPROGMODE
CHOOSE 1-2: <strong>1</strong>   XUPROG

Another key: <strong>XUPROGMODE</strong>

Another key: <strong>XMMGR</strong>

Another key: <strong>XUSPF200</strong>

Another key:

Holder of key: <strong>MANAGER,SYSTEM</strong>       SM

Another holder:

You've selected the following keys:
XUPROG     XUMGR     XUPROGMODE     XMMGR   XUSPF200

You've selected the following holders:

MANAGER,SYSTEM

You are allocating keys. Do you wish to proceed? YES//

XUPROG being assigned to:
   MANAGER,SYSTEM

XUMGR being assigned to:
   MANAGER,SYSTEM

XUPROGMODE being assigned to:
   MANAGER,SYSTEM

XMMGR being assigned to:
   MANAGER,SYSTEM

XUSPF200 being assigned to:
   MANAGER,SYSTEM

Select Key Management Option: <strong>&lt;enter&gt;</strong></code></div>
<p>You are now ready to enter additional information for the system manager user like PRIMARY MENU, VERIFY CODE etc. You MUST enter a VERIFY CODE, otherwise, you won't be able to log in.</p>
<div class="code"><code>><strong>D ^XUP</strong>

Setting up programmer environment
Terminal Type set to: C-VT320

Select OPTION NAME: <strong>XUSERED</strong>
    1   XUSEREDIT   Edit an Existing User
    2   XUSEREDITSELF   Edit User Characteristics
CHOOSE 1-2: <strong>1</strong> XUSEREDIT  Edit an Existing User
Edit an Existing User
Select NEW PERSON NAME: <strong>MANAGER,SYSTEM</strong>    SM</code></div>
<p>Before we go into details of the next screen, let's talk about the &lt;PF1&gt; key. Press &lt;PF1&gt; refers to notations for use of Vista on Terminals. For example, the original VT-320 keyboard had additional character sets and keys which include Find, Select, Insert, Remove, Previous Screen, Next Screen, an arrow cluster and F1 to F20. With Terminal Emulators, the Keys are &quot;mapped&quot;, which means when you push a given key it acts as the key would in a terminal. For instance, F1, F2, F3 and F4 are equivalent to the PF1, PF2, PF3 and PF4 keys on the terminal keyboard and Page Up and Page Down on the computer keyboard correspond to Previous Screen and Next Screen. Also there is lots of information about terminals if you are interested at <a href="http://www.vt100.net" class="uri">http://www.vt100.net</a>. Also, the very beginning of this document tells you what are the recommended terminal emulators to use.</p>
<p>Now you will be presented with a screen with multiple options. You can navigate the screen with the TAB key. For navigation help, use your keyboard arrows to move down to the command line and hold down either the Num Lock key (which is mapped as PF1 of a VT-320 terminal by Caché) or F1 for other terminal emulations and hit &quot;H&quot; and then Enter for help. You can exit by typing &quot;^&quot; on the command line and the change you made will be saved. At a minimum, assign EVE as the PRIMARY MENU and enter IRM (it's the only choice) as SERVICE/SECTION. If you plan to use CPRS, enter OR CPRS GUI CHART as a SECONDARY MENU OPTION. Enter other data as you deem appropriate. If DISUSER or Termination Reason is set, use the '@' to delete both of them. To avoid problems down the road with a division that you didn't set-up, delete the DIVISION (tab to it, then enter, then @) that you see in the screen (unlike the screenshot below). No division means that the user will default to the main division, PALM DESERT HOSPITAL, which we already previously set-up.</p>
<figure>
<img src="images/InitializeVistA/pic25.gif" class="align-center" />
</figure>
<p>Type &quot;N&quot;EXT PAGE at COMMAND: to go to page 2 to update the TIMED READ field and other fields you wish to update. For DEFAULT TIMED-READ (SECONDS): if you change it to 3600 you will be allow an hour before being automatically signed off. It makes it easier to work when you are learning and setting things up. And for God's sake, please make sure that your Preferred Editor is <code>SCREEN EDITOR - VA FILEMAN</code>, otherwise you can only edit a line of text at a time.</p>
<figure>
<img src="images/InitializeVistA/pic26.gif" class="align-center" />
</figure>
<p>At this point, you can go back to Direct Mode. We will now run <code>^ZU</code>, which is the VistA front door, or in the above analogy, the City Portal. At the VISTA prompt, Type <code>D ^ZU</code>.</p>
<p>At ACCESS CODE, type in the code you chose when setting up MANAGER, SYSTEM as a NEW PERSON. At VERIFY CODE, enter the verify code you chose for yourself earlier, and then you will be asked to change it. The introduction message &quot;This is my test system.&quot; is what we put in a while ago in the Kernel Set-Up section.</p>
<div class="code"><code>><strong>D ^ZU</strong>
This is my test system.



Volume set: ROU:Macintosh  UCI: VAH  Device: /dev/ttys007

ACCESS CODE: <strong>******</strong>
VERIFY CODE: <strong>*********</strong>
Device: /dev/ttys007

Good evening MANAGER,SYSTEM
     You last signed on today at 22:20
There were 2 unsuccessful attempts since you last signed on.


          Core Applications ...
          Device Management ...
          Menu Management ...
          Programmer Options ...
          Operations Management ...
          Spool Management ...
          Information Security Officer Menu ...
          Taskman Management ...
          User Management ...
          Application Utilities ...
          Capacity Planning ...
          HL7 Main Menu ...

Select Systems Manager Menu <TEST ACCOUNT> Option:</code></div>
<p>At Select Systems Manager Menu Option: Type <code>OPER</code>, (short for operations management) and hit enter. You can see all of the choices available to you if you type <code>??</code>.</p>
<p>At Select Operations Management Option: Type <code>KER</code> short for Kernel Management Menu and hit enter. At Select Kernel Management Menu Option: Type <code>ENT</code>, short for Enter/Edit Kernel Site Parameters. Hit enter.</p>
<p>You will be presented with a similar screen as in editing the SYSTEM MANAGER characteristics. You can navigate the screen with the <code>TAB</code> key. For DEFAULT TIMED-READ (SECONDS): change it to <code>3600</code> to allow an hour before being automatically signed off, or whatever you choose.</p>
<p>I <em>strongly</em> recommend setting <code>DEFAULT MULTIPLE SIGN-ON</code> to YES.</p>
<figure>
<img src="images/InitializeVistA/pic27.gif" class="align-center" />
</figure>
<p>Now you can exit this screen. Press &lt;PF1&gt;/&lt;F1&gt;-S and &lt;PF1&gt;/&lt;F1&gt;-E; and then press enter 4 times. You will be dumped back to your operating system. (Exit from the front door <code>^ZU</code> dumps you all the way out from VistA. Type <code>mumps -dir</code> on GT.M or <code>csession &lt;INSTANCE&gt; -U &lt;NAMESPACE&gt;</code> to get back into direct mode for the next step.</p>
<h2 id="mail-a-message">Mail a Message</h2>
<p>Now send a message using Postmaster to your DUZ number. From Direct Mode, type <code>S DUZ=.5 D ^XUP</code>. You will get the response SETTING UP PROGRAMMER ENVIRONMENT then TERMINAL TYPE SET TO: (your default) and Select OPTION NAME:. You will need to respond: <code>XMUSER</code>. At Select Mailman Menu Option: type <code>S</code> (for send). At Subject: enter your subject, such as Test, and then hit enter. You will then be prompted You may enter the text of the message and you will be offered the line number 1&gt; where you can type your message, such as the infamous Hello world. Next will be line 2&gt; and if you are done, just hit enter and at EDIT Option: you can do the same. At Send mail to: POSTMASTER// enter the initials you used for your DUZ which were probably DBA for System Manager. You will then be told when Mailman was last used, which is probably NEVER. Hit enter at And Send to: and you should receive the message Select Message option: Transmit now// at which you hit enter and will hopefully receive the message Sending [1] Sent. Type <code>^</code> to exit.</p>
<p>Now see if you received it. Log on using <code>D ^ZU</code>. At the Systems Manager prompt, type <code>MAILMAN MENU</code>. If you don't see the NEW messages option, it means that you need to navigate to the submenu, and type &quot;MAILMAN&quot; again. Then at the Select Mailman Menu Option: type <code>NEW</code> Messages and Responses. Read the mail (figure out the steps on your own).</p>
<figure>
<img src="images/InitializeVistA/pic32.gif" class="align-center" />
</figure>
<h2 id="add-cprs-user">Add CPRS User</h2>
<p>The next step is to create a user that can sign on to the CPRS GUI. The things to make sure that this new user has are</p>
<ul>
<li>A Secondary menu option of &quot;OR CPRS GUI CHART&quot;</li>
<li>CPRS Tab Access</li>
<li>An ACCESS CODE</li>
<li>A VERIFY CODE</li>
<li>Service/Section (required for any user)</li>
</ul>
<p>The menu option ensures that the user has the proper permissions to access CPRS after signing in with their ACCESS and VERIFY codes. The Tab access can limit the amount of things a user can access once they have signed in.</p>
<p>The adding of the user is done through the User Management menu in the menu system, which will ask for information in a series of prompts then will open a Screenman form to complete the task.</p>
<p>The following steps will add a generic <code>CPRS,USER</code> person who will be able to sign into CPRS.</p>
<p>From the previous mail message example, exiting out of mailman and pressing enter a couple of times will get you back to the System Manager Menu <code>EVE</code>. If you signed out, go back through the front door using <code>mumps -r ZU</code> (GTM/YDB) or <code>csession &lt;instance&gt; -U &lt;namespace&gt; ZU</code>.</p>
<div class="code"><code>

        Core Applications ...
        Device Management ...
        Menu Management ...
        Programmer Options ...
        Operations Management ...
        Spool Management ...
        Information Security Officer Menu ...
        Taskman Management ...
        User Management ...
        Application Utilities ...
        Capacity Planning ...
        HL7 Main Menu ...


Select Systems Manager Menu <TEST ACCOUNT> Option: <strong>User Management</strong>

        Add a New User to the System
        Grant Access by Profile
        Edit an Existing User
        Deactivate a User
        Reactivate a User
        List users
        User Inquiry
        Switch Identities
        File Access Security ...
           \**> Out of order:  ACCESS DISABLED
        Clear Electronic signature code
        Electronic Signature Block Edit
        List Inactive Person Class Users
        Manage User File ...
        OAA Trainee Registration Menu ...
        Person Class Edit
        Reprint Access agreement letter


Select User Management <TEST ACCOUNT> Option: <strong>Add a New User to the System</strong>
Enter NEW PERSON's name (Family,Given Middle Suffix): <strong>CPRS,USER</strong>
  Are you adding 'CPRS,USER' as a new NEW PERSON (the 56TH)? No// <strong>Y</strong>  (Yes)
Checking SOUNDEX for matches.
No matches found.
Now for the Identifiers.
INITIAL: <strong>UC</strong>
SSN: <strong>&lt;enter&gt;</strong>
SEX: <strong>F</strong>  FEMALE
NPI: <strong>&lt;enter&gt;</strong></code></div>
<p>Once in the Screenman form, you will need to set the necessary information mentioned above. Four pieces of information are able to be set on the first page of the Screenman form. The arrows are for emphasis to highlight where information needs to be entered and will not show up in the terminal window.</p>
<p>To add an access or verify codes, you need to first answer <code>Y</code> to the <code>Want to edit ...</code> questions, it will then prompt you to change the codes. Remember to give the user both an access and veify codes; otherwise, they won't be able to log-in.</p>
<p>Fill in as follows:</p>
<ul>
<li>PRIMARY MENU OPTION = XUCORE</li>
<li>SECONDARY MENU OPTIONS = OR CPRS GUI CHART</li>
<li>ACCESS CODE = CPRS1234</li>
<li>VERIFY CODE = USR.1234</li>
<li>SERVICE/SECTION = IRM</li>
</ul>
<div class="code"><code>                            Edit an Existing User
NAME: CPRS,USER                                                     Page 1 of 5
_______________________________________________________________________________
   NAME... CPRS,USER                                   INITIAL: UC
    TITLE:                                           NICK NAME:
      SSN:                                                 DOB:
   DEGREE:                                           MAIL CODE:
  DISUSER:                                     TERMINATION DATE:
  Termination Reason:

           PRIMARY MENU OPTION:   <---
 Select SECONDARY MENU OPTIONS:   <---
Want to edit ACCESS CODE (Y/N):   <---  FILE MANAGER ACCESS CODE:
Want to edit VERIFY CODE (Y/N):   <---

              Select DIVISION:
         ---> SERVICE/SECTION:
_______________________________________________________________________________
 Exit     Save     Next Page     Refresh

Enter a command or '^' followed by a caption to jump to a specific field.


COMMAND:                                     Press <PF1>H for help    Insert</code></div>
<p>To change to other pages, press the down arrow key or &lt;TAB&gt; until the cursor reaches the COMMAND box. Then type <code>N</code> or <code>Next Page</code> and press &lt;enter&gt; to display the next page.</p>
<p>There is nothing that needs to be set on the second page. On the third page, you MUST put in a provider person class (Physician, Nurse, etc; otherwise you won't be able to be a provider on encounters). Navigate to Person Class and then type &quot;PHYSICIAN&quot;, press enter twice, and then choose #1. Press enter once, say yes, and then enter. At this point, you should see the entry; and the effective date should be today.</p>
<div class="code"><code>                            Edit an Existing User
NAME: CPRS,USER                                                     Page 3 of 5
_______________________________________________________________________________
PROHIBITED TIMES FOR SIGN-ON:                      

           PHONE:                        OFFICE PHONE:                     
COMMERCIAL PHONE:                          FAX NUMBER:                     
     VOICE PAGER:                       DIGITAL PAGER:                     
        LANGUAGE:           

 Person Class                                         Effective     Expired

 Physician Assistants and Advanced Practi          DEC 4,2016                 




_______________________________________________________________________________

Exit    Save    Next Page    Previous Page    Refresh    Quit

Enter a COMMAND, or "^" followed by the CAPTION of a FIELD to jump to.
COMMAND: e                                       Press <PF1>H for help  Insert</code></div>
<p>On the fourth page, CPRS Tab Access is set. Navigate first to &quot;RESTRICT PATIENT SELECTION&quot;, set that to &quot;NO&quot;, and then navigate the cursor to the location under the <code>Name</code> header and enter <code>COR</code>, which stands <code>for Core Tab Access</code>, and enter an effective date of yesterday, <code>T-1</code> is the notation to use.</p>
<div class="code"><code>                            Edit an Existing User
NAME: CPRS,USER                                                     Page 4 of 5
_______________________________________________________________________________
RESTRICT PATIENT SELECTION:->      OE/RR LIST:

CPRS TAB ACCESS:
  Name  Description                          Effective Date  Expiration Date
->








_______________________________________________________________________________





COMMAND:                                       Press <PF1>H for help</code></div>
<p>Once that is done, save and exit the Screenman form via the COMMAND box and then answer the final questions regarding access letters, security keys and mail groups. For security keys, there are two we need to add: ORES and PROVIDER.</p>
<div class="code"><code>Exit     Save     Next Page     Refresh

Enter a command or '^' followed by a caption to jump to a specific field.


COMMAND: <strong>E</strong>                                     Press <PF1>H for help    Insert

Print User Account Access Letter? <strong>NO</strong>
Do you wish to allocate security keys? NO// <strong>YES</strong>

Allocate key: <strong>PROVIDER</strong>
     1   PROVIDER  
     2   PROVIDER ID EDIT  IB PROVIDER EDIT
CHOOSE 1-2: <strong>1</strong>  PROVIDER

Another key: <strong>ORES</strong>  

Another key: <strong>&lt;enter&gt;</strong>

Another holder: <strong>&lt;enter&gt;</strong>

You've selected the following keys: 

PROVIDER       ORES

You've selected the following holders: 

CPRS,USER

You are allocating keys.  Do you wish to proceed? YES// <strong>&lt;enter&gt;</strong>

PROVIDER being assigned to:
     CPRS,USER

ORES being assigned to:
     CPRS,USER

Do you wish to add this user to mail groups? NO// <strong>NO</strong>

...

Select User Management <TEST ACCOUNT> Option: <strong>^&lt;enter&gt;</strong>
></code></div>
<p>At this point, CPRS can successfully connect to the local VistA instance and the <code>CPRS,USER</code> will be able to sign on and interact with the GUI.</p>
<h2 id="downloading-cprs-and-running-it">Downloading CPRS and Running It</h2>
<p>The next part is laborious and tedious: finding the correct vesion of CPRS to run on your FOIA instance.</p>
<p><em>NB: If you have been following on a Linux or Mac machine so far, you need to switch to Windows or use Wine 1.8 or higher to run CPRS. Earlier versions of Wine had an unimplemented function in comctl32.dll that prevented CPRS from running.</em></p>
<p>The first thing is that you need to go into Fileman, and find out what the version of CPRS you need to use is:</p>
<div class="code"><code>><strong>S DUZ=1 D Q^DI</strong>


VA Fileman 22.2


Select OPTION: <strong>INQUIRE TO FILE ENTRIES</strong>  



Output from what File: <strong>19</strong>  OPTION         (10351 entries)
Select OPTION NAME: <strong>OR CPRS GUI CHART</strong>       CPRSChart version 1.0.30.75
Another one: <strong>^</strong></code></div>
<p>Okay. So we need <code>1.0.30.75</code>. So we navigate here: <a href="http://foia-vista.osehra.org/Patches_By_Application/CPRS%20GUI%20FILES/">http://foia-vista.osehra.org/Patches_By_Application/CPRS%20GUI%20FILES/</a>, and from there, try to guess which version we need. From my version string, it looks like we need version 30. There are three version 30's; so I guess I should choose the latest one.</p>
<p>At this point, we need to look for a .zip file. Looking through the list, I see</p>
<ul>
<li>OR_30_423_scrubbed.zip</li>
<li>OR_30_423_SRC_scrubbed.zip</li>
</ul>
<p>The one most likely to contain the CPRS exe is OR_30_423_scrubbed.zip; SRC_scrubbed.zip is the CPRS source code, which also may contain a compiled version.</p>
<p><em>Please please note that this is what I see when I write this at the end of 2016; what you see in the future will certainly be different.</em></p>
<p>So I download OR_30_423_scrubbed.zip, and open it. There is a CPRSChart.exe in that one. But what version?</p>
<p>We can find that out by right clicking on the exe, choosing properties, and then choosing the 4th tab. Over there, you will see the version number. Make sure that that's the right version number compared with what you have.</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/right_click_on_cprs.png" class="align-center" />
</figure>
<figure>
<img src="images/InitializeVistA/CPRSPropertiestab0.png" class="align-center" />
</figure>
<figure>
<img src="images/InitializeVistA/CPRSPropertiestab3.png" class="align-center" />
</figure>
</blockquote>
<p>If you have the right version, we can try running it, but you will get an error right away saying that 'borlndmm.dll' is needed.</p>
<p>You can find 'borlndmm.dll' in the source code download referenced above (the zip file that contains SRC in the name) in the CPRS-Chart folder. While I am updating these instructions, I found that the 'borlndmm.dll' was actually with CPRSChart.exe. Copy that file to the folder where the CPRSChart.exe is located at.</p>
<p>Now, try to run CPRS again. You will get this splash screen:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/CPRS_Splash_Screen.png" class="align-center" />
</figure>
</blockquote>
<p>But then, you may see this:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/connection_timeout.png" class="align-center" />
</figure>
</blockquote>
<p>What you have to do is to invoke CPRS with 3 parameters in order to tell it where and how to connect.</p>
<ul>
<li>s=&lt;ip address or DNS server name&gt;</li>
<li>p=&lt;port&gt;</li>
<li>ccow=disable</li>
</ul>
<p>The way to do that on Microsoft Windows for end users is to create a shortcut and modify the target. Therefore, here's what you need to do: right click on CPRS, and choose &quot;Create Shortcut&quot;. You will see a shortcut icon right in the same window. Something that looks like this:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/shorcut_icon.png" class="align-center" />
</figure>
</blockquote>
<p>Right-click on that, and then click (i.e. left click) on properties. You will see the following:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/shortcut_properties.png" class="align-center" />
</figure>
</blockquote>
<p>In the target field, append the s, p, and ccow as described above. Here is mine:</p>
<pre><code>C:\Users\Hp\Desktop\FOIACPRS31a.exe s=192.168.1.181 p=9000 ccow=disable</code></pre>
<p>Click OK. You will see that CPRS connects, and display the access and verify screen:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/VISTASign-on.png" class="align-center" />
</figure>
</blockquote>
<p>Now, put in the access and verify codes. If you followed along, this would be CPRS1234 and USR.1234.</p>
<p>Once you sign-in, since you are signing in for the first time, you will be asked to change your verify code:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/CVC.png" class="align-center" />
</figure>
</blockquote>
<p>Go ahead and change it (no screen shot shown) and then click OK. It will confirm that it changed, and then you will see the patient selection screen.</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/CPRSPatientSelection.png" class="align-center" />
</figure>
</blockquote>
<p>You should be happy when you reach this point; except that a medical records system is useless without patients.</p>
<h2 id="registering-your-first-patient">Registering your First Patient</h2>
<p>Let's register a patient. Login using the CPRS User we just set-up.</p>
<blockquote>
<p>NB: On GT.M/YottaDB, patient registration will crash, as it tries to use Cache Specific Code. To fix that, we need to edit some routines. To edit a routine in GT.M/YDB, it's easiest to just edit it on the shell. You will recall that we installed VistA in /var/db/&lt;name&gt;. And we copied all routines into the r directory. edit the code, use an editor (a simple editor to use is nano) and edit the file. For example, to edit MPIFXMLP, enter <code>nano /var/db/&lt;name&gt;/r/MPIFXMLP.m</code>.</p>
<p>If you want to register the patient on GT.M/YottaDB, edit routine MPIFXMLP, changing the label PATIENT to ZPATIENT</p>
<p>In routine DGRPD, in line 34 remove the errant space:</p>
<p><code>N DGSKIP S DGSKIP=$S(DGFORGN:&quot;!,?42,&quot;&quot;From/To: &quot;&quot;&quot;,1:&quot;?42, &quot;&quot;From/To: &quot;&quot;&quot;)</code></p>
<p>to</p>
<p><code>N DGSKIP S DGSKIP=$S(DGFORGN:&quot;!,?42,&quot;&quot;From/To: &quot;&quot;&quot;,1:&quot;?42,&quot;&quot;From/To: &quot;&quot;&quot;)</code></p>
</blockquote>
<p>Now we can register the patient.</p>
<div class="code"><pre>><strong>$ mumps -r ^ZU</strong>
This is my test system.

Volume set: ROU:Macintosh  UCI: VAH  Device: /dev/ttys001

ACCESS CODE: <strong>*****************</strong> (Access Code;Verify Code)

Good afternoon CPRS,USER
     You last signed on today at 16:36


   DENT   Dental ...
   EN     Engineering Main Menu ...
   FEE    Fee Basis Main Menu ...
   FH     Dietetic Administration ...
   GECO   Miscellaneous Code Sheet Manager Menu ...
   GECS   Generic Code Sheet Menu ...
   GMRA   Adverse Reaction Tracking ...
   IB     Integrated Billing Master Menu ...
   MCAR   Medicine Menu ...
   NU     Nursing System Manager's Menu ...
   PDX    Patient Data Exchange ...
   PROS   Prosthetic Official's Menu ...
   PRPF   Patient Funds (INTEGRATED) System ...
   RA     Rad/Nuc Med Total System Menu ...
   ROES   Remote Order/Entry System ASPS Menu ...
   RT     Record Tracking Total System Menu ...
   SR     Surgery Menu ...
   SW     Information Management Systems (SWIMS) ...
   TIU    TIU Maintenance Menu ...
   VMAS   Volunteer Timekeeping Activity ...
   VOL    Volunteer Master Menu ...
   YSM    MHS Manager ...

           Press 'RETURN' to continue, '^' to stop: <strong>&lt;enter&gt;</strong>
   YSU    Mental Health ...
          ADT Manager Menu ...
          CPRS Manager Menu ...
          CPRS Menu
          Employee Menu ...
          Finance AR Manager Menu ...
          Health Summary Coordinator's Menu ...
          Health Summary Enhanced Menu ...
          Health Summary Menu ...
          IV Menu ...
          Library Management ...
          National Drug File Menu ...
          Outpatient Pharmacy Manager ...
          Payroll Main Menu ...
          Payroll Supervisor Menu ...
          Scheduling Manager's Menu ...
          Serials Control ...
          Unit Dose Medications ...

Select Core Applications <TEST ACCOUNT> Option: <strong>ADT Manager Menu</strong>


CPT codes and descriptions are copyright 2016 by the American Medical
Association (AMA).  All Rights Reserved.  CPT is a registered trademark of the
American Medical Association.

Press any key to continue<strong>&lt;enter&gt;</strong>


          ADT Outputs Menu ...
          Bed Control Menu ...
          Beneficiary Travel Menu ...
          Contract Nursing Home RUG Menu ...
          Eligibility Inquiry for Patient Billing
          MAS Code Sheet Manager Menu ...
          Patient Inquiry
          PTF Menu ...
          Registration Menu ...
          RUG-II Menu ...

Select ADT Manager Menu <TEST ACCOUNT> Option: <strong>Registration Menu</strong>


    DA     Disposition an Application
    EN     Patient Enrollment
    PHH    Purple Heart Request History
    PHS    Purple Heart Status Report
           Add/Edit/Delete Catastrophic Disability
           Collateral Patient Register
           Combat Vet Status Report
           Delete a Registration
           Disposition Log Edit
           Edit Inconsistent Data for a Patient
           Eligibility Inquiry for Patient Billing
           Eligibility Verification
           Load/Edit Patient Data
           Means Test User Menu ...
           Patient Inquiry
           Preregistration Menu ...
           Print Patient Wristband
           Pseudo SSN Report (Patient)
           Register a Patient
           Report - All Address Change with Rx
           Report - All Address Changes
           Report - All Patients flagged with a Bad Address

               Press 'RETURN' to continue, '^' to stop:<strong>&lt;enter&gt;</strong>
           Unsupported CV End Dates Report
           View Patient Address
           View Registration Data

Select Registration Menu <TEST ACCOUNT> Option: <strong>Register a Patient</strong>

  Select PATIENT NAME: <strong>MOUSE,MINNIE</strong>
       ARE YOU ADDING 'MOUSE,MINNIE' AS A NEW PATIENT (THE 2ND)? No// <strong>Y</strong> (Yes)
       PATIENT SEX: <strong>F</strong> FEMALE
       PATIENT DATE OF BIRTH: <strong>11/11/47</strong>  (NOV 11, 1947)
       PATIENT SOCIAL SECURITY NUMBER: <strong>P</strong>  505111148P
       PATIENT PSEUDO SSN REASON: <strong>N</strong> NO SSN ASSIGNED
       PATIENT TYPE: <strong>N</strong>
           1   NEWBORN OF VETERAN
           2   NON-VETERAN (OTHER)
           3   NSC VETERAN
  CHOOSE 1-3: <strong>2</strong>  NON-VETERAN (OTHER)
       PATIENT VETERAN (Y/N)?: <strong>N</strong> NO
       PATIENT SERVICE CONNECTED?: <strong>N</strong> NO
       PATIENT MULTIPLE BIRTH INDICATOR:<strong>&lt;enter&gt;</strong>

       ...searching for potential duplicates..

       The following patients have been identified as potential duplicates:

           MOUSE,MICKEY      11-11-47    505111147P **Pseudo SSN**     NO     NON-VETE
  RAN (OTHER)

       Do you still want to add 'MOUSE,MINNIE' as a new patient? No// <strong>Y</strong>  (Yes)

       ...adding new patient...new patient added

  Patient name components--
  FAMILY (LAST) NAME: MOUSE//<strong>&lt;enter&gt;</strong>
  GIVEN (FIRST) NAME: MINNIE//<strong>&lt;enter&gt;</strong>
  MIDDLE NAME:<strong>&lt;enter&gt;</strong>
  PREFIX:<strong>&lt;enter&gt;</strong>
  SUFFIX:<strong>&lt;enter&gt;</strong>
  DEGREE:<strong>&lt;enter&gt;</strong>
  Press ENTER to continue<strong>&lt;enter&gt;</strong>

  Please verify or update the following information:<strong>&lt;enter&gt;</strong>

  MOTHER'S MAIDEN NAME:<strong>&lt;enter&gt;</strong>
  PLACE OF BIRTH [CITY]:<strong>&lt;enter&gt;</strong>
  PLACE OF BIRTH [STATE]:<strong>&lt;enter&gt;</strong>
  Select ALIAS:<strong>&lt;enter&gt;</strong>

  Attempting to connect to the Master Patient Index in Austin...
  If no SSN or inexact DOB or common name, this request
  may take some time, please be patient...


  Could not connect to MPI or Timed Out, assigning local ICN (if not already assig
  ned)...<strong>&lt;enter&gt;</strong>

  MOUSE,MINNIE                            505-11-1148P             NOV 11,1947
  =============================================================================
   Address: STREET ADDRESS UNKNOWN        Temporary: NO TEMPORARY ADDRESS
                   UNK. CITY/STATE

      County: UNSPECIFIED                     From/To: NOT APPLICABLE
       Phone: UNSPECIFIED                       Phone: NOT APPLICABLE
      Office: UNSPECIFIED
          Cell: UNSPECIFIED
      E-mail: UNSPECIFIED
  Bad Addr:

   Confidential Address:                      Confidential Address Categories:
                   NO CONFIDENTIAL ADDRESS
   From/To: NOT APPLICABLE

          POS: UNSPECIFIED                      Claim #: UNSPECIFIED
      Relig: UNSPECIFIED                          Sex: FEMALE
       Race: UNANSWERED                     Ethnicity: UNANSWERED
  Type &lt;Enter&gt; to continue or '^' to exit: <strong>^</strong></code></div>
<p>Now, if you run CPRS again, you will see a patient, and you can select them:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/CPRSPatientSelection2.png" class="align-center" />
</figure>
</blockquote>
<p>and then you will see the cover sheet:</p>
<blockquote>
<figure>
<img src="images/InitializeVistA/CPRSCoverSheet.png" class="align-center" />
</figure>
</blockquote>
<p>There is little you can do because most of VistA is not set-up. But you can now get an idea of what CPRS is like. The most important step is to at least create one clinic. You can do that in the SDBUILD menu. Doing this will unlock most of CPRS for you.</p>
<p>You can learn more about using CPRS from here: <a href="https://www.vehu.va.gov/cprs_training.cfm" class="uri">https://www.vehu.va.gov/cprs_training.cfm</a>.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="./SetupClinics.html">Set-up Clinics</a></li>
<li>Set-up MAS Parameters (Part 1 of setting up a hospital)</li>
<li>Set-up Wards and Beds (Part 2 of setting up a hospital)</li>
<li>Install a Drug File, or create one from Scratch</li>
<li>Set-up Outpatient Pharmacy</li>
<li>Set-up Inpatient Pharmacy</li>
<li>Set-up Lab Package for Chemistry and Hematology</li>
</ul>
<h2 id="stopping-vista">Stopping VistA</h2>
<p>To stop Taskman, use <code>D STOP^ZTMKU</code> and answer <code>YES</code> to stopping the submanagers.</p>
<p>To stop Broker, use <code>D STOP^XWBTCP(&lt;port no&gt;)</code>.</p>
<p>To stop mailman, use <code>D STOP^XMKPL</code> and answer <code>YES</code> to stop it.</p>
</body>
</html>
